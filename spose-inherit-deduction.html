<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>배우자 상속공제 명세서 </title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.5;
            margin: 0;
            padding: 30px;

        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 0px;

        }
        td {
            border: 1px solid;
            padding: 0px;
            text-align: left;
        }

        /*  위쪽과 아래쪽 굵은 테두리 */
        table tr:first-child {
            border-top: 2px solid #000;
        }
        table tr:last-child {
            border-bottom: 2px solid #000;
        }
        /* 옆쪽 테두리 제거 */
        table, th, td {
            border-left: none;
            border-right: none;
        }

        .table-container {
            margin-bottom: 10px;
        }
        input[type="text"] {
            width: 100%;
            height: 100%;
            padding: 5px;
            box-sizing: border-box;
        }

        .number-input {
            text-align: right;
        }


        .result {
            font-weight: bold;
            text-align: right;
            font-size: 15px;
        }
        .amount-cell {
            text-align: right;
        }
        /* Add print styles */
    @media print {
        /* Set the page size to A4 */
        @page {
            size: A4;
            margin: 15mm; /* Adjust margins as needed */
        }

        /* Adjust body margins and padding for print */
        body {
            margin: 0;
            padding: 0;
        }

        /* Hide elements that shouldn't appear in print */
        #resetButton , #printButton , #spouseLegalSharePercent {
            display: none;

        }

        /* Adjust table styles for printing */
        table {
            width: 100%;
            font-size: 12px; /* Adjust font size for print */
        }

        td, th {
            padding: 3px; /* Reduce padding to fit more content */
        }

        /* Additional print-specific styles if needed */
    }

    </style>
</head>
<body>
    <p style="font-size: 10px; color: #2b2a2a; text-align: left; margin-bottom: 5px;">[별지 제9호서식 부표 3의2](2020.03.13 개정)</p>
    <div class="table-container">
        <h2 style="text-align: center; color: #333; margin-bottom: 20px;">배우자 상속공제 명세서</h2>


        <div style="text-align: right; margin-top: 20px;">
            <button id="printButton" style="padding: 10px 20px;">인쇄하기</button>
            <button id="resetButton" style="padding: 10px 20px;">초기화</button>
        </div>


        <h4>가. 배우자가 실제 상속받은 금액</h4>
        <table>
            <tr>
                <td>① 배우자가 상속받은 상속재산가액</td>
                <td  width="30%" ><input type="text" id="inheritanceAsset" class="number-input"></td>
            </tr>
            <tr>
                <td>② 배우자가 승계하기로 한 채무 공과금 </td>
                <td><input type="text" id="debtAndTax" class="number-input"></td>
            </tr>
            <tr>
                <td>③ 배우자가 상속받은 비과세 재산가액</td>
                <td><input type="text" id="taxExemption" class="number-input"></td>
            </tr>
            <tr>
                <td>④ 배우자가 실제 상속받은 금액 (① - ② - ③ ) </td>
                <td class="amount-cell"><span id="inheritedAmount" class="result"></span></td>
            </tr>
        </table>
    </div>

    <div class="table-container">

        <h4>나. 배우자 상속공제 한도액</h4>
        <table>
            <tr>
                <td rowspan="5">상속재산의 가액 <br>「상속세및증여세법시행령」 <br> 제17조 </td>
                <td>⑤ 총 상속재산가액</td>
                <td  width="30%" ><input type="text" id="totalInheritance" class="number-input"></td>
            </tr>
            <tr>
                <td>⑥ 비과세되는 상속재산</td>
                <td><input type="text" id="taxExemption2" class="number-input"></td>
            </tr>
            <tr>
                <td>⑦ 공과금 및 채무</td>
                <td><input type="text" id="taxAndDebt" class="number-input"></td>
            </tr>
            <tr>
                <td>⑦ 과세가액 불산입 재산</td>
                <td><input type="text" id="nonTaxableAmount" class="number-input"></td>
            </tr>
            <tr>
                <td>⑨ 상속재산의 가액  (⑤ - ⑥ - ⑦ - ⑧) </td>
                <td class="amount-cell"><span id="taxableInheritance" class="result"></span></td>
            </tr>
        </table>
    </div>

    <div class="table-container">

        <table>

            <tr>
                <td>⑩ 상속재산 중 상속인이 아닌 수유자가 유증등을 받은<br>
                      재산의 가액</td>
                <td  width="30%" ><input type="text" id="nonHeirAmount" class="number-input"></td>
            </tr>
            <tr>
                <td>⑪ 상속개시일 전 10이내에 피상속인이 상속인에게 증여한 <br>
                      재산가액</td>
                <td><input type="text" id="giftAmount" class="number-input"></td>
            </tr>
            <tr>
                <td>⑫ 배우자의 법정상속지분</td>
                <td>
                    <input type="text" id="spouseLegalShare" placeholder="자녀 2명인 경우:  1.5 / 3.5" style="width: 50%;">
                    <span id="spouseLegalSharePercent" style="margin-left: 10px;"></span>
                </td>
            </tr>
            <tr>
                <td>⑬ 상속 재산에 가산한 증여재산 중 배우자가 사전 증여받은 재산에<br>
                      대한 과세표준  「상속세및증여세법시행령」 제55조 제 1항 </td>
                <td><input type="text" id="spousePriorGift" class="number-input"></td>
            </tr>
            <tr>
                <td>⑭ 배우자상속공제 한도액 [ { (⑨ - ⑩ + ⑪) x ⑫ - ⑬} ] <br>
                      (다만, 30억원을 초과하는 경우는  30억원 )</td>
                <td class="amount-cell"><span id="spouseLimitAmount" class="result"></span></td>
            </tr>
        </table>
    </div>

    <div class="table-container">

        <h4>다. 배우자 상속공제 금액</h4>
        <table>
            <tr>
                <td> ⑮ 배우자 상속공제 금액 (④ 와 ⑭ 중 적은금액 )<br>
                ( 다만, 배우자가 실제 상속받은 금액이 없거나 실제 상속받은 <br>
                 금액이 5억원 미만인 경우는 5억원 ) </td>
                <td class="amount-cell" width="30%" ><span id="spouseInheritanceAmount" class="result"></span></td>
            </tr>
        </table>
    </div>

    <div class="table-container">

        <table>
            <tr>
                <td>신청(신고)인 제출서류 : </td>
                <td>협의분할서, 기타 분할사실을 입증할 수 있는 서류</td>
            </tr>
        </table>
    </div>

    <script>
    // Fraction 클래스 정의
    class Fraction {
        constructor(numerator, denominator) {
            if (denominator === 0) {
                throw new Error("Denominator cannot be zero");
            }
            this.numerator = numerator;
            this.denominator = denominator;
            this.simplify();
        }

        simplify() {
            const gcd = this.getGCD(Math.abs(this.numerator), Math.abs(this.denominator));
            this.numerator /= gcd;
            this.denominator /= gcd;
            if (this.denominator < 0) {
                this.numerator *= -1;
                this.denominator *= -1;
            }
        }

        getGCD(a, b) {
            return b === 0 ? a : this.getGCD(b, a % b);
        }

        multiply(other) {
            return new Fraction(this.numerator * other.numerator, this.denominator * other.denominator);
        }

        toString() {
            return `${this.numerator}/${this.denominator}`;
        }

        toDecimal(precision = 6) {
            return (this.numerator / this.denominator).toFixed(precision);
        }
    }

    function formatNumber(num) {
    // 소수점 이하 절사
    num = Math.floor(num);
    return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

    // 쉼표가 포함된 문자열을 숫자로 변환
    function unformatNumber(str) {
        return parseFloat(str.replace(/,/g, "")) || 0;
    }

    // 입력 필드에 천 단위 쉼표 적용
    function formatInput(input) {
        let value = input.value.replace(/[^\d]/g, '');
        if (value !== "") {
            value = formatNumber(parseInt(value, 10));
        }
        input.value = value;
    }

    // 분수 문자열을 Fraction 객체로 변환
    function parseFraction(fractionStr) {
        const parts = fractionStr.split('/');
        if (parts.length === 2) {
            const numerator = parseFloat(parts[0]);
            const denominator = parseFloat(parts[1]);

            if (!isNaN(numerator) && !isNaN(denominator) && denominator !== 0) {
                return new Fraction(numerator, denominator);
            }
        }
        return null;
    }

    // 모든 number-input 클래스를 가진 입력 필드에 이벤트 리스너 추가
    document.querySelectorAll('.number-input').forEach(input => {
        input.addEventListener('input', function() {
            formatInput(this);
            calculateAll();
        });
    });

    // 배우자의 법정상속지분 입력 처리
    document.getElementById('spouseLegalShare').addEventListener('input', function() {
        const fractionValue = this.value;
        const fraction = parseFraction(fractionValue);
        if (fraction) {
            const percentValue = (fraction.toDecimal() * 100).toFixed(6);
            document.getElementById('spouseLegalSharePercent').textContent = `(${percentValue}%)`;
            calculateAll();
        } else {
            document.getElementById('spouseLegalSharePercent').textContent = '';
        }
    });

    // 상속받은 금액 계산
    function calculateInheritance() {
        const inheritanceAsset = unformatNumber(document.getElementById('inheritanceAsset').value);
        const debtAndTax = unformatNumber(document.getElementById('debtAndTax').value);
        const taxExemption = unformatNumber(document.getElementById('taxExemption').value);
        const inheritedAmount = inheritanceAsset - debtAndTax - taxExemption;
        document.getElementById('inheritedAmount').textContent = formatNumber(inheritedAmount);
    }

    // 상속재산의 가액 계산
    function calculateTaxableInheritance() {
        const totalInheritance = unformatNumber(document.getElementById('totalInheritance').value);
        const taxExemption2 = unformatNumber(document.getElementById('taxExemption2').value);
        const taxAndDebt = unformatNumber(document.getElementById('taxAndDebt').value);
        const nonTaxableAmount = unformatNumber(document.getElementById('nonTaxableAmount').value);
        const taxableInheritance = totalInheritance - taxExemption2 - taxAndDebt - nonTaxableAmount;
        document.getElementById('taxableInheritance').textContent = formatNumber(taxableInheritance);

    }

    // 배우자 한도금액 계산
    function calculateSpouseLimitAmount() {
        const taxableInheritance = unformatNumber(document.getElementById('taxableInheritance').textContent);
        const nonHeirAmount = unformatNumber(document.getElementById('nonHeirAmount').value);
        const giftAmount = unformatNumber(document.getElementById('giftAmount').value);
        const spouseLegalShareStr = document.getElementById('spouseLegalShare').value;
        const spousePriorGift = unformatNumber(document.getElementById('spousePriorGift').value);

        const spouseLegalShareFraction = parseFraction(spouseLegalShareStr);
        if (!spouseLegalShareFraction) {
            document.getElementById('spouseLimitAmount').textContent = ' ';
            return;
        }

        const spouseLegalShare = spouseLegalShareFraction.toDecimal(4);
        let spouseLimitAmount = (taxableInheritance - nonHeirAmount + giftAmount) * spouseLegalShare - spousePriorGift;
        spouseLimitAmount = Math.min(spouseLimitAmount, 3000000000); // 30억 한도
        document.getElementById('spouseLimitAmount').textContent = formatNumber(spouseLimitAmount);

        calculateSpouseInheritanceAmount();
    }

    // 배우자 상속금액 계산
    function calculateSpouseInheritanceAmount() {
        const inheritedAmount = unformatNumber(document.getElementById('inheritedAmount').textContent);
        const spouseLimitAmount = unformatNumber(document.getElementById('spouseLimitAmount').textContent);
        const spouseInheritanceAmount = Math.max(Math.min(inheritedAmount, spouseLimitAmount), 500000000);
        document.getElementById('spouseInheritanceAmount').textContent = formatNumber(spouseInheritanceAmount);
    }

    // 모든 계산 함수 실행
    function calculateAll() {
        calculateInheritance();
        calculateTaxableInheritance();
        calculateSpouseLimitAmount();
    }

    // 초기 계산 실행
    calculateAll();


// 데이터 저장 및 복원, 초기화
    function saveData() {
    const data = {};
    document.querySelectorAll('.number-input, #spouseLegalShare').forEach(input => {
        data[input.id] = input.value;
    });
    localStorage.setItem('formData', JSON.stringify(data));
}

// For number inputs
document.querySelectorAll('.number-input').forEach(input => {
    input.addEventListener('input', function() {
        formatInput(this);
        calculateAll();
        saveData();
    });
});

// For spouse legal share input
document.getElementById('spouseLegalShare').addEventListener('input', function() {
    // Existing code to handle fraction parsing...
    saveData();
});

function loadData() {
    const data = JSON.parse(localStorage.getItem('formData'));
    if (data) {
        for (const id in data) {
            const input = document.getElementById(id);
            if (input) input.value = data[id];
        }
        // Update spouse legal share percent display if needed
        calculateAll();
    }
}

window.addEventListener('load', loadData);

document.getElementById('resetButton').addEventListener('click', function() {
    if (confirm('입력한 모든 데이터를 삭제하시겠습니까?')) {
        localStorage.removeItem('formData');
        document.querySelectorAll('.number-input, #spouseLegalShare').forEach(input => {
            input.value = '';
        });
        document.querySelectorAll('.result').forEach(span => {
            span.textContent = '';
        });
        document.getElementById('spouseLegalSharePercent').textContent = '';
        calculateAll();
    }
});

// Event listener for the print button
document.getElementById('printButton').addEventListener('click', function() {
    window.print();
});

    </script>
</body>
</html>
