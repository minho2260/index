<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>상속세 과세가액 명세서</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.4;
            margin: 0;
            padding: 30px;
            font-size: 16px;
        }

        h1, h2 {
            text-align: center;
        }

        h3, h4 {
            text-align: left;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 0px;
            margin-top: 10px;
        }

        .currency-input {
            width: 100%;
            box-sizing: border-box;
        }


        th {
            border: 1px solid;
            padding: 1px;
            text-align: center;

        }

        td {
            border: 1px solid;
            padding: 1px;
            text-align: left;

        }

        td {
            white-space: nowrap; /* 텍스트 줄바꿈 방지 */
        }

        /* price 입력 필드를 오른쪽 정렬 */
        input[name="price"] {
            text-align: right; /* 숫자 입력 필드의 텍스트를 오른쪽 정렬 */
        }

        /* total 및 grandTotal 등 셀을 오른쪽 정렬 , input 도다 구체성 높임*/
        td.total,
        td#grandTotal,
        td input.input-field,
        td input.currency-input,
        .currency-input,
        td input.debt-amount,
        td input.utility-amount,
        td input.funeral-amount,
        td#debtTotal, /* id가 'debtTotal'인 td와 th 요소 */
        td#utilityTotal, /* id가 'utilityTotal'인 td와 th 요소 */
        td#funeralTotal, /* id가 'funeralTotal'인 td와 th 요소 */
        #field13,
        #field17,
        #field25,
        #field29 {
            text-align: right; /*각종금액 오른쪽정렬  */
        }

        input.currency-input {
            text-align: right !important;
        }


        /*  위쪽과 아래쪽 굵은 테두리 */
        table tr:first-child {
            border-top: 2px solid #000;
        }

        table tr:last-child {
            border-bottom: 2px solid #000;
        }

        /* 옆쪽 테두리 제거 */
        table, th, td {
            border-left: none;
            border-right: none;
        }


        input[type="text"], input[type="number"] {
            width: 100%;
            box-sizing: border-box;
            text-align: center;
            white-space: nowrap; /* 텍스트 줄 바꿈 방지 */
            font-size: 15px;
        }


        .checkbox-container {
            display: flex;
            justify-content: space-evenly;
            margin: 2px 0;
        }

        .button-container {
            margin: 1px 0;
        }

        /* 삭제 버튼과 모든 모달 버튼에 동일한 스타일 적용 */
        td button[onclick*="deleteRow"],
        td button[onclick*="openmodalStep2"],
        td button[id^="openModal"], /* id가 'openModal'로 시작하는 모든 버튼 선택 */
        button[id^="openModal"], /* td 외부의 openModal 버튼들도 선택 */
        button[onclick*="openmodalStep2"] { /* 스텝 전체에 있는 openmodalStep2 호출 버튼 */
            margin: 2px 2px 2px 0;
            padding: 2px 2px;
            background-color: #9F244D; /* 배경색 변경 */
            color: white; /* 글자색 흰색으로 변경 */
            border: none; /* 테두리 제거 */
            border-radius: 5px; /* 버튼 모서리 둥글게 */
        }


        /* 삭제 버튼을 제외한 다른 모든 버튼에 스타일 적용 */
        button:not([onclick*="deleteRow"]) {
            margin: 5px 5px; /* 더 큰 여백 */
            padding: 10px 20px; /* 더 큰 패딩으로 버튼을 크게 만듦 */
            background-color: #9F244D; /* 배경색 변경 */
            color: white; /* 글자색 흰색으로 변경 */
            border: none; /* 테두리 제거 */
            border-radius: 5px; /* 버튼 모서리 둥글게 */
            font-size: 14px; /* 텍스트 크기 증가 */
        }


        /* 재산구분선택 */
        .selector {
            cursor: pointer;
        }

        /* 모달 창 스타일 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            z-index: 1000;
        }

        .modal {
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background-color: #9F244D; /* 배경색 변경 */
            color: white; /* 글자색 흰색으로 변경 */
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            justify-content: center;
            gap: 15px;
            width: 100%;
        }

        .modal-content button {
            flex: 0 1 auto;
            padding: 15px 20px;
            text-align: left;
            background-color: #e0e0e0;
            border: none;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            font-weight: bold;
            color: #333;
            white-space: nowrap;
            width: 100%;
            margin: 10px 0;
        }

        .modal-content button:hover {
            background-color: #d0d0d0;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        /* 모달 창 Step2 스타일 수정 */
        .modalStep2 {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #ffffff;
            padding: 50px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            font-family: 'Helvetica Neue', Arial, sans-serif;
            width: 80%;
            max-width: 700px;
            transition: opacity 0.3s ease;
            opacity: 0;
        }

        .modalStep2.open {
            display: block;
            opacity: 1;
        }

        .modalStep2 h2 {
            margin-top: 0;
            color: #333;
            font-size: 24px;
        }

        .modalStep2 p {
            color: #666;
            line-height: 1.6;
            font-size: 16px;
        }

        .modalStep2 button {
            background-color: #9F244D;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 16px;
        }

        .modalStep2 button:hover {
            background-color: #9F244D;
        }

        /* 입력 필드 스타일 */
        .modalStep2 .input-field {
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        /* 모달 창 내부 배치 */
        .modal-actions {
            margin-top: 30px;
            display: flex;
            justify-content: flex-end;
        }

        .modal-actions button {
            margin-left: 10px;
        }

        @media (max-width: 480px) {
            .modalStep2 {
                width: 85%;
                padding: 30px;
            }

            .modalStep2 h2 {
                font-size: 1.5em;
            }

            .modalStep2 p {
                font-size: 1em;
            }

            .modalStep2 button {
                padding: 12px 18px;
                font-size: 0.9em;
            }
        }

        /* x표시 디자인 */
        .close {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #aaa;
            font-size: 36px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
            line-height: 1;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 50%;
        }

        .close:hover {
            color: #333;
            background-color: rgba(0, 0, 0, 0.2);
        }

        .help-button {
            font-size: 14px;
            margin-left: 15px;
            padding: 8px 12px;
            cursor: pointer;
            background-color: #9F244D;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .help-button:hover {
            background-color: #9F244D;
        }

        @keyframes popIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }


        /* 5단계 이미지 관련 디자인 */
        .image-container {
            margin: 30px 0;
            text-align: center;
        }

        .image-container img {
            max-width: 70%;
            height: auto;
            cursor: zoom-in;
            transition: transform 0.3s ease;
        }

        .image-container img.zoomed {
            transform: scale(1.2);
            cursor: zoom-out;
        }

        .note {
            background-color: #f8f8f8;
            border-left: 5px solid #e74c3c;
            padding: 15px 20px;
            margin: 30px 0;
        }

        .highlight {
            background-color: #fffacd;
            padding: 4px 8px;
        }

        ul, ol {
            padding-left: 35px;
        }


        /* select 요소의 기본 스타일 제거 */
        select {
            border: none;
            background: none;
            appearance: none;
            -moz-appearance: none;
            -webkit-appearance: none;
            width: 100%;
            padding: 0;
            font-size: 1em;
            cursor: pointer;
            text-align: center;
        }

        /* select 요소의 포커스 효과 제거 */
        select:focus {
            outline: none;
        }

        /* 1개의 웹페이지에서는 한방향으로 만 돼서 선택 */
        .print-hint {
            background-color: #f8eded;
            border-left: 5px solid #f12d0f;
            padding: 10px 15px;
            margin-bottom: 20px;
            font-size: 14px;
        }


        /* 인쇄용 스타일 */

        @media print {

            @page {

                margin: 10mm;
            }

            .step-landscape {
                transform: rotate(0deg); /* 회전 제거 */
                width: 100%; /* 전체 너비 사용 */
                height: auto; /* 높이 자동 조정 */
                position: relative; /* absolute 대신 relative 사용 */
                left: 0; /* 왼쪽 위치 조정 */
                page-break-before: always; /* 새 페이지에서 시작 */
                overflow: visible; /* 내용이 넘칠 경우 표시 */
            }

            /* 효율적인 단계별 인쇄 처리 */
            .step {
                display: none;
            }

            body[data-print-step] [id^="step"]:not([id="step" + attr(data-print-step)

        ]) {
            display: none;
        }
            body[data-print-step] [id="step" +

        attr(data-print-step)] {
            display: block;
        }
            body[data-print-all] .step {
                display: block;
            }

            /* 폰트 크기 조정 */
            body {
                font-size: 8pt;
            }

            p, h4, td, th {
                font-size: 8pt;
            }

            input[type="text"],
            input[type="number"] {
                font-size: 8pt;
            }

            /* 인쇄 시 버튼과 특정 열 숨기기 */
            button, th:nth-child(11), td:nth-child(11) {
                display: none;
            }

            .no-print {
                display: none;
            }

            a {
                text-decoration-line: none; /* Remove underline only */
                color: black; /* Text color */
            }


        }


    </style>
</head>
<body>

<div id="step1" style="display: block;" class="step step-landscape">

    <div class="print-area"></div>

    <h2>상 속 세 과 세 가 액 계 산 명 세 서 (별지)</h2>

    <h4>가. 상속받은 총재산명세</h4>
    <table id="assetTable">
        <thead>
        <tr>
            <th rowspan="2">① 재산구분코드</th>
            <th rowspan="2">② 재산종류코드</th>
            <th colspan="3" style="width: 25%;">③ 소재지</th>

            <th rowspan="2" style="width: 12%;"> ④ 사업자등록번호<br>(계좌번호,지분)</th>
            <th rowspan="2">⑤ 수량(면적)</th>
            <th rowspan="2" style="width: 11%;"> ⑥ 단 가</th>
            <th rowspan="2" style="width: 12%;"> ⑥ 평가가액</th>
            <th rowspan="2">⑧ 평가기준코드</th>
            <th class="no-print" rowspan="2">삭제</th>
        </tr>
        <tr>
            <th>국외자산<br> 여부</th>
            <th>국외재산<br> 국가명</th>
            <th style="width: 28%;">소재지ㆍ법인명</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td><span class="assetTypeSelector selector">선택</span></td>
            <td><span class="propertyTypeSelector selector">선택</span></td>
            <td>
                <div class="checkbox-container">
                    <label><input type="radio" name="isForeign1" value="yes">여</label>
                    <label><input type="radio" name="isForeign1" value="no">부</label>
                </div>
            </td>
            <td><input type="text" name="foreignCountry"></td>
            <td><input type="text" name="location"></td>
            <td><input type="text" name="registrationNumber"></td>
            <td><input type="number" name="quantity" value="0"></td>
            <td><input type="number" name="price" value="0"></td>
            <td class="total">0</td>
            <td><span class="evaluationStandardSelector selector"
                      style="display: flex; justify-content: center; align-items: center; height: 100%;">선택</span></td>
            <td>
                <button onclick="deleteRow(this)">삭제</button>
            </td>
        </tr>
        </tbody>
        <tfoot>
        <tr>
            <td colspan="8">계</td>
            <td id="grandTotal">0</td>
            <td></td>
        </tr>
        </tfoot>
    </table>

    <div class="button-container">
        <button onclick="addRow()">행 추가</button>
        <button onclick="saveAssetData()">데이터 저장</button>
        <button onclick="loadAssetData()">데이터 불러오기</button>
        <button onclick="clearAssetData()">데이터 삭제</button>
    </div>

    <!-- 재산구분코드 선택 모달 -->
    <div id="assetTypeModal" class="modal-overlay">
        <div class="modal">
            <span class="close">&times;</span>
            <div class="modal-content">
                <h2>재산구분코드 </h2>
                <p>※ 여기는 반드시 선택해야만 다음 단계에서 값을 이어 받아 계산할수 있습니다. </p>
                <div id="assetTypeContent"></div>
            </div>
        </div>
    </div>
    <!-- 재산 종류 선택 모달 -->
    <div id="propertyTypeModal" class="modal-overlay">
        <div class="modal">
            <span class="close">&times;</span>
            <div class="modal-content">
                <h2>재산 종류 코드 선택</h2>
                <div id="propertyTypeContent"></div>
            </div>
        </div>
    </div>

    <!-- 평가 기준 선택 모달 -->
    <div id="evaluationStandardModal" class="modal-overlay">
        <div class="modal">
            <span class="close">&times;</span>
            <div class="modal-content">
                <h2>평가 기준 선택</h2>
                <div id="evaluationStandardContent"></div>
            </div>
        </div>
    </div>


    <button onclick="nextStep(2)">다음</button>
    <button onclick="printStep(1)">1단계 인쇄</button>
    <div class="print-hint no-print">
        <p>이 문서는 <strong>가로</strong> 방향으로 인쇄하세요.</p>
    </div>

</div>
</div>

<div id="step2" style="display: none;" class="step">

    <div class="print-area">


        <p style="font-size: 10px; color: #2b2a2a; text-align: left; margin-bottom: -10px;">[별지 제9호서식](2020.0313 개정)</p>
        <h2 style="text-align: center; color: #333; margin-bottom: -10px;">채무 · 공과금 · 장례비용 및 상속공제명세서 </h2>

        <!-- 채무 테이블 -->
        <p><strong>가. 채무 </strong></p>
        <table id="debtTable">
            <tr>
                <th style="width: 10%;" rowspan="2">① 채무종류</th>
                <th colspan="2">② 차입기간</th>
                <th colspan="3"> 채권자</th>
                <th rowspan="2"> ⑥ 금액</th>
            </tr>
            <tr>
                <th>발생연원일</th>
                <th>종료(예정)연월일</th>
                <th> ③ 성명(상호)</th>
                <th style="width:15%;">④ 주민등록번호<br>(사업자등록번호)</th>
                <th style="width:25%;">⑤ 주소(소재지)</th>
            </tr>
            <tbody id="debtTableBody">
            <!-- 행이 동적으로 생성됩니다. -->
            </tbody>
            <tr class="total">
                <th>⑦계</th>
                <th colspan="5"></th>
                <th id="debtTotal">0</th>
            </tr>
        </table>

        <!-- 공과금 테이블 -->
        <p><strong>나. 공과금 </strong></p>
        <table id="utilityTable">
            <tr>
                <th>⑧ 공과금종류코드</th>
                <th>⑨ 연도별</th>
                <th>⑩ 분기별</th>
                <th>⑪ 금액</th>
            </tr>
            <tbody id="utilityTableBody">
            <!-- 행이 동적으로 생성됩니다. -->
            </tbody>
            <tr class="total">
                <th>⑫ 계</th>
                <th colspan="2"></th>
                <th id="utilityTotal">0</th>
            </tr>
        </table>

        <!-- 장례비용 테이블 -->
        <p><strong>다. 장례비용 </strong></p>
        <table id="funeralTable">
            <tr>
                <th colspan="2">지급처</th>
                <th rowspan="2">⑮ 지급내역</th>
                <th rowspan="2">⑯ 금액</th>
            </tr>
            <tr>
                <th>⑬ 주민등록번호<br>(사업자등록번호)</th>
                <th> ⑭ 성명(상호)</th>
            </tr>
            <tbody id="funeralTableBody">
            <!-- 행이 동적으로 생성됩니다. -->
            </tbody>
            <tr class="total">
                <th>⑰ 계</th>
                <th colspan="2"></th>
                <th id="funeralTotal">0</th>
            </tr>
        </table>

        <!-- 상속 공제 테이블 -->
        <p><strong>라. 상속 공제 </strong></p>
        <table>
            <tbody>
            <tbody>

            <tr>
                <td rowspan="5"> ⑱ 기초공제 및 <br> 그 밖의 인적공제</td>
                <td> ⑱ 기초공제</td>
                <td><input type="text" id="baseDeduction" class="input-field" value="200,000,000" readonly></td>

            </tr>
            <tr>
                <td>⑲ 자녀공제
                    <button onclick="openmodalStep2('child')">계산</button>
                </td>
                <td><input type="text" id="childDeduction" class="input-field" value="0" readonly></td>

            </tr>
            <tr>
                <td>⑳ 미성년자공제
                    <button onclick="openmodalStep2('minor')">계산</button>
                </td>
                <td><input type="text" id="minorDeduction" class="input-field" value="0" readonly></td>

            </tr>
            <tr>
                <td>㉑ 연로자공제
                    <button onclick="openmodalStep2('elder')">계산</button>
                </td>
                <td><input type="text" id="elderDeduction" class="input-field" value="0" readonly></td>

            </tr>
            <tr>
                <td>㉒ 장애인공제
                    <button onclick="openmodalStep2('disabled')">계산</button>
                </td>
                <td><input type="text" id="disabledDeduction" class="input-field" value="0" readonly></td>

            </tr>
            <tr>
                <td colspan="2">㉓ 일괄공제</td>
                <td><input type="text" id="totalDeduction" class="input-field" value="500,000,000" readonly></td>

            </tr>
            <tr>
                <td rowspan="2">추가 상속공제</td>
                <td>㉔ 가업상속공제</td>
                <td><input type="text" id="businessInheritance" class="input-field" value="0"
                           oninput="formatAndCalculate()"></td>

            </tr>
            <tr>
                <td> ㉕ 영농상속공제</td>
                <td><input type="text" id="farmingInheritance" class="input-field" value="0"
                           oninput="formatAndCalculate()"></td>

            </tr>
            <tr>
                <td colspan="2">㉖ <a href="/spose-inherit-deduction" target="_blank">배우자상속공제</a></td>
                <td><input type="text" id="spouseInheritance" class="input-field" value="0"
                           oninput="formatAndCalculate()"></td>

            </tr>
            <tr>
                <td colspan="2">㉗ <a href="/finantial-asset-deduction" target="_blank">금융재산 상속공제</a></td>
                <td><input type="text" id="financialInheritance" class="input-field" value="0"
                           oninput="formatAndCalculate()"></td>

            </tr>
            <tr>
                <td colspan="2">㉘ 재해손실세액공제</td>
                <td><input type="text" id="disasterTaxDeduction" class="input-field" value="0"
                           oninput="formatAndCalculate()"></td>

            </tr>
            <tr>
                <td colspan="2"> ㉙<a href="/co-habitation-deduction" target="_blank"> 동거주택 상속공제</a></td>
                <td><input type="text" id="cohabitationDeduction" class="input-field" value="0"
                           oninput="formatAndCalculate()"></td>

            </tr>
            <tr>
                <td colspan="2">㉚ <a href="/inheritance-deduction-limit" target="_blank"> 공제 적용 한도액</a></td>
                <td><input type="text" id="deductionLimit" class="input-field" value="0" oninput="formatAndCalculate()">
                </td>

            </tr>

            <tr>
                <td colspan="2"><strong>㉛ 상속 공제 금액 합계</strong></td>
                <td><input type="text" id="totalDeductionSum" class="input-field" value="0" readonly></td>

            </tr>
            </tbody>
        </table>
        <table>
            <tr>
                <td>신청(신고인)제출서류</td>
                <td> 1. 채무부담 및 공과금 장례비 감정평가수수료 지급 입증서류</td>
            </tr>

        </table>

        <!-- 저장, 불러오기, 삭제 버튼 -->
        <button onclick="saveDataToLocalStorage2()">데이터 저장 2</button>
        <button onclick="loadDataFromLocalStorage2()">데이터 불러오기 2</button>
        <button onclick="deleteDataFromLocalStorage2()">데이터 삭제 2</button>


        <!-- 모달 창 -->
        <div id="modalStep2" class="modalStep2">
            <div class="modal-content">
                <h2 id="modalStep2Title"></h2>
                <p id="modalStep2Description"></p>
                <input type="number" id="modalStep2Input1" class="input-field" placeholder="입력값">
                <input type="number" id="modalStep2Input2" class="input-field" placeholder="추가 입력값"
                       style="display:none;">
                <div class="modal-actions">
                    <button onclick="applymodalStep2()">반영</button>
                    <button onclick="closemodalStep2()">닫기</button>
                </div>
            </div>
        </div>


    </div>
    <button class="no-print" onclick="nextStep(3)">다음</button>
    <button class="no-print" onclick="previousStep(1)">뒤로가기</button>
    <button onclick="printStep(2)">2단계 인쇄</button>

    <div class="print-hint no-print">
        <p>이 문서는 <strong>세로</strong> 방향으로 인쇄하세요.</p>
    </div>
</div>

<div id="step3" style="display: none;" class="step step-landscape">
    <div class="print-area">

        <p style="font-size: 10px; color: #2b2a2a; text-align: left; margin-bottom: -10px;">[상속세및 증여세법 시행규칙 별지 제9호서식
            부표1] (2024.03.22 개정)</p>
        <h2 style="text-align: center; color: #333; margin-bottom: 0px;">상 속 세 과 세 가 액 계 산 명 세 서</h2>
        <p style="font-size: 10px; color: #2b2a2a; text-align: left; margin-bottom: 0px;">፠ 뒤쪽의 작성방법을 읽고 작성하시기 바랍니다.</p>


        <h3>가. 상속받은 총재산명세</h3>
        <div style="position: relative;">
            <div style="position: absolute; top: 60px; left: 50%; transform: translateX(-30%); background-color: #f5f5f5; border: 1px solid black; padding: 5px 10px; font-weight: bold; font-size: 1em;">
                별지 참조
            </div>
            <table>
                <tr>
                    <th rowspan="2">① 재산구분 코드</th>
                    <th rowspan="2">② 재산종류 코드</th>
                    <th colspan="3">③ 소재지ㆍ법인명 등</th>
                    <th rowspan="2">④ 사업자등록번호 (계좌번호,지분)</th>
                    <th rowspan="2">⑤ 수량 (면적)</th>
                    <th rowspan="2">⑥ 단가</th>
                    <th rowspan="2">⑦ 평가가액</th>
                    <th rowspan="2">⑧ 평가기준 코드</th>
                </tr>

                <tr>
                    <th>국외자산 여부</th>
                    <th>국외재산 국가명</th>
                <tr>
                    <td></td>
                    <td>[ ]여 [ ]부</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>


                <tfoot>
                <tr id="totalRow">
                    <td colspan="6">계</td>
                    <td></td>
                    <td></td>
                    <td id="grandTotal"></td>
                    <td></td>

                </tr>
                </tfoot>


            </table>
        </div>


        <!-- STEP3의 상속세 과세가액 계산 부분 -->
        <h3>나. 상속세 과세가액 계산</h3>

        <table style="table-layout: fixed; width: 100%;">
            <tr>
                <td rowspan="3">총상속재산가액</td>
                <td>⑩ 상속재산가액</td>
                <td style="width: 25%;">
                    <input type="text" id="field10" class="currency-input" readonly style="width: 100%;">
                </td>
            </tr>
            <tr>
                <td>⑪ 상속개시전 처분재산등 산입액 (「상속세 및 증여세법」 제15조)</td>
                <td><input type="text" id="field11" class="currency-input" readonly></td>
            </tr>
            <tr>
                <td>⑫ 합계</td>
                <td><input type="text" id="field12" class="currency-input" readonly></td>
            </tr>

            <tr>
                <td rowspan="4">비과세 재산가액 (「상속세 및 증여세법」 제12조)</td>
                <td>⑬계</td>
                <td class="currency-input" id="field13"></td> <!-- 계산된 비과세 총액 표시 -->
            </tr>
            <tr>
                <td> ⑭ 금양임야등가액 (「민법」 제1008조의 3)</td>
                <td><input type="text" id="field14" class="currency-input" readonly></td>
            </tr>
            <tr>
                <td>⑮ 공공단체유증재산가액</td>
                <td><input type="text" id="field15" class="currency-input" readonly></td>
            </tr>
            <tr>
                <td> ⑯ 기타</td>
                <td><input type="text" id="field16" class="currency-input" readonly></td>
            </tr>

            <tr>
                <td rowspan="4">과세가액불산입</td>
                <td class="currency-input">⑰ 계</td>
                <td id="field17"></td> <!-- 계산된 불산입 가액 총액 표시 -->
            </tr>
            <tr>
                <td>⑱공익법인 출연재산가액 (「상속세 및 증여세법」 제16조)</td>
                <td><input type="text" id="field18" class="currency-input" readonly></td>
            </tr>
            <tr>
                <td>⑲ 공익신탁재산가액 (「상속세 및 증여세법」 제17조)</td>
                <td><input type="text" id="field19" class="currency-input" readonly></td>
            </tr>
            <tr>
                <td> ⑳ 기타</td>
                <td><input type="text" id="otherExcludedValue" class="currency-input" readonly></td>
            </tr>

            <tr>
                <td rowspan="4">공제금액 (「상속세 및 증여세법」 제14조)</td>
                <td>㉑ 계</td>
                <td class="currency-input" id="field21"></td> <!-- 계산된 공제금액 총액 표시 -->
            </tr>
            <tr>
                <td> ㉒공과금</td>
                <td><input type="text" id="field22" class="currency-input" readonly></td>
            </tr>
            <tr>
                <td>㉓ 장례비용</td>
                <td><input type="text" id="field23" class="currency-input" readonly></td>
            </tr>
            <tr>
                <td>㉔ 채무</td>
                <td><input type="text" id="field24" class="currency-input" readonly></td>
            </tr>

            <tr>
                <td rowspan="4">가산하는 증여재산가액</td>
                <td>㉕ 계(㉖ + ㉗ 또는㉗ + ㉘)</td>
                <td class="currency-input" id="field25"></td> <!-- 계산된 증여재산가액 총액 표시 -->
            </tr>
            <tr>
                <td>㉖ 「상속세 및 증여세법」 제13조</td>
                <td><input type="text" id="field26" class="currency-input" readonly></td>
            </tr>
            <tr>
                <td> ㉗ 「조세특례제한법」 제30조의 5</td>
                <td><input type="text" id="field27" class="currency-input" readonly></td>
            </tr>
            <tr>
                <td>㉘ 「조세특례제한법」 제30조의 6</td>
                <td><input type="text" id="field28" class="currency-input" readonly></td>
            </tr>

            <tr>
                <td colspan="2"> ㉙ 상속세 과세가액[ ⑫ - ( ⑬ + ⑰ + ㉑ ) + ㉕]</td>
                <td class="currency-input" id="field29"></td> <!-- 계산된 상속세 과세가액 표시 -->
            </tr>
        </table>


    </div>

    <button class="no-print" onclick="nextStep(4)">다음</button>
    <button class="no-print" onclick="previousStep(2)">뒤로가기</button>
    <button onclick="printStep(3)">3단계 인쇄</button>

    <div class="print-hint no-print">
        <p>이 문서는 <strong>가로</strong> 방향으로 인쇄하세요.</p>
    </div>
</div>

<div id="step4" style="display: none;" class="step">
    <div class="print-area">
        <p style="font-size: 10px; color: #2b2a2a; text-align: left; margin-bottom: -10px;">[상속세및 증여세법 시행규칙 별지 제9호서식
            부표1] (2024.03.22 개정)</p>
        <h1 style="text-align: center; color: #333; margin-bottom: 0px;">상속세과세표준신고 및 자진납부계산서</h1>
        <p style="font-size: 10px; color: #2b2a2a; text-align: left; margin-bottom: 0px;">፠ 뒤쪽의 작성방법을 읽고 작성하시기 바랍니다.</p>


        <form style="text-align: center;">
            <label><input type="radio" name="filingType" value="기한내신고" checked>기한내신고</label>
            <label><input type="radio" name="filingType" value="수정신고">수정신고</label>
            <label><input type="radio" name="filingType" value="기한후신고">기한후신고</label>
        </form>


        <table>
            <!-- 신고인 Section -->
            <tr>
                <td rowspan="3">신고인</td>
                <td>① 성명</td>
                <td><input type="text" id="applicant_name"></td>
                <td>② 주민등록번호</td>
                <td><input type="text" id="applicant_ssn"></td>
                <td>③ 전자우편 주소</td>
                <td><input type="text" id="applicant_email"></td>
            </tr>
            <tr>
                <td>④ 주소</td>
                <td colspan="3"><input type="text" id="applicant_address" style="width: 97%;"></td>
                <td>⑤ 피상속인<br>과의관계</td>
                <td>
                            <span>
                                <select id="relationship">
                                    <option value="">선택하세요</option>
                                    <option value="배우자">배우자</option>
                                    <option value="자녀">자녀</option>
                                    <option value="손자녀">손자녀</option>
                                    <option value="기타상속인">기타상속인</option>
                                </select>
                            </span>
                </td>
            </tr>
            <tr>
                <td>⑥ 전화번호:자택</td>
                <td><input type="text" id="applicant_phone_home"></td>
                <td> 휴대전화:</td>
                <td><input type="text" id="applicant_phone_mobile"></td>
                <td>사후관리위반신고</td>
                <td><input type="checkbox" id="post_management_violation"></td>
            </tr>

            <!-- 피상속인 Section -->
            <tr>
                <td rowspan="3">피상속인</td>
                <td>⑦ 성명</td>
                <td><input type="text" id="deceased_name"></td>
                <td>⑧ 주민등록번호</td>
                <td><input type="text" id="deceased_ssn"></td>
                <td>⑨ 거주구분</td>
                <td>
                    <label><input type="radio" name="residency" value="거주자" checked>거주자</label>
                    <label><input type="radio" name="residency" value="비거주자">비거주자</label>
                </td>
            </tr>
            <tr>
                <td>⑩ 주소</td>
                <td colspan="5"><input type="text" id="deceased_address" style="width: 97%;"></td>
            </tr>
            <tr>
                <td>⑪ 상속원인</td>
                <td colspan="3">
                    <label><input type="radio" name="inheritance_cause" value="사망">사망</label>
                    <label><input type="radio" name="inheritance_cause" value="실종">실종</label>
                    <label><input type="radio" name="inheritance_cause" value="인정사망">인정사망</label>
                    <label><input type="radio" name="inheritance_cause" value="기타">기타</label>
                </td>
                <td>⑫ 상속개시일</td>
                <td><input type="date" id="inheritance_date"></td>
            </tr>

            <!-- 세무대리인 Section -->
            <tr>
                <td rowspan="2">세무<br>대리인</td>
                <td>⑬ 성명</td>
                <td><input type="text" id="agent_name"></td>
                <td>⑭ 사업자등록번호</td>
                <td><input type="text" id="agent_business_number"></td>
                <td>⑮ 관리번호</td>
                <td><input type="text" id="agent_management_number"></td>
            </tr>
            <tr>
                <td>⑯ 전화번호</td>
                <td>사무실:</td>
                <td><input type="text" id="agent_office_phone"></td>
                <td>휴대전화:</td>
                <td colspan="2"><input type="text" id="agent_mobile_phone"></td>
            </tr>
        </table>


        <table style="width: 100%; table-layout: fixed;">
            <colgroup>
                <!-- 왼쪽 항목 그룹 -->
                <col span="4" style="width: 20%;">
                <col style="width: 30%;">
                <!-- 오른쪽 항목 그룹 -->
                <col span="4" style="width: 20%;">
                <col style="width: 30%;">
            </colgroup>
            <!-- 테이블 헤더 -->
            <tr>
                <!-- 왼쪽 항목 그룹 -->
                <th colspan="4">항목</th>
                <th>금액</th>
                <!-- 오른쪽 항목 그룹 -->
                <th colspan="4">항목</th>
                <th>금액</th>
            </tr>
            <!-- 테이블 내용 -->


            <tr>
                <td colspan="4">⑰ 상속세 과세가액</td>
                <td><input type="text" id="taxableInheritanceAmount" class="currency-input" placeholder="금액을 입력하세요">
                </td>
                <td style="text-align: center; vertical-align: middle;" rowspan="3">영리<br>법인<br>면제</td>
                <td colspan="3">유증 등 재산가액</td>
                <td></td>
            </tr>
            <tr>
                <td colspan="4">⑱ 상속공제액</td>
                <td><input type="text" id="inheritanceDeductionAmount" class="currency-input" placeholder="금액을 입력하세요">
                </td>
                <td colspan="3">면제세액 「상속세 및 증여세법 제3조2」</td>
                <td></td>
            </tr>
            <tr>
                <td colspan="4">⑲ 감정평가 수수료</td>
                <td><input type="text" id="appraisalFee" class="currency-input" placeholder="5백초과시 5백만원 한도"></td>
                <td colspan="3" onclick="alert('영리법인에게 유증한 경우로서 특수관계자가 있는 경우 일정액을 입력합니다.');" style="cursor: pointer;">㉟
                    영리법인면제분납부세액
                    <button id="openModal4">입력</button>
                </td>
                <td><input type="text" id="profitCorpTaxExemption" class="currency-input" readonly></td>
            </tr>
            <tr>
                <td rowspan="2" colspan="4">⑳ 과세표준 (⑰-⑱-⑲)</td>
                <td rowspan="2"><input type="text" id="taxableBase" class="currency-input" readonly></td>
                <td colspan="4">㊱ 공제면제후 납부할 세액㉔ + ㉕ + ㉖ - ㉗ + ㉟</td>
                <td><input type="text" id="amountAfterDeductions" class="currency-input" readonly></td>
            </tr>
            <tr>
                <td colspan="4" onclick="alert('가업상속이 있는 경우 유예세액입니다.');" style="cursor: pointer;">㊲ 가업상속납부유예세액</td>
                <td><input type="text" id="deferredBusinessInheritanceTax" class="currency-input" placeholder=""></td>
            </tr>
            <tr>
                <td rowspan="2" colspan="4">㉑ 세율 (%)</td>
                <td rowspan="2"><input type="text" id="taxRate" readonly></td>
                <td colspan="4" onclick="alert('신고기한 내 신고하지 못한 경우입니다.');" style="cursor: pointer;">㊳ 신고불성실가산세</td>
                <td><input type="text" id="underReportingPenalty" class="currency-input" placeholder=""></td>
            </tr>
            <tr>
                <td colspan="4" onclick="alert('신고기한 내 납부하지 못한 경우입니다.');" style="cursor: pointer;">㊴ 납부지연가산세</td>
                <td><input type="text" id="delayedPaymentPenalty" class="currency-input" placeholder=""></td>
            </tr>
            <tr>
                <td colspan="4">㉒ 산출세액</td>
                <td><input type="text" id="calculatedTax" class="currency-input" readonly></td>
                <td colspan="4">㊵ 납부할 세액 (합계액) ㊱ - ㊲ + ㊳ + ㊴</td>
                <td><input type="text" id="amountToBePaid" class="currency-input" readonly></td>
            </tr>
            <tr>
                <td colspan="4">
                    <a href="https://tuzaga.com/%ec%84%b8%eb%8c%80%eb%a5%bc-%ea%b1%b4%eb%84%88%eb%9b%b4-%ec%83%81%ec%86%8d%ec%9d%98-%ed%95%a0%ec%a6%9d%ea%b3%bc%ec%84%b8/"
                       target="_blank">㉓ 세대생략가산액</a>
                    <button id="openModal1">입력</button>
                </td>
                <td><input type="text" id="generationSkippingSurtax" class="currency-input" readonly></td>
                <td>납부방법</td>
                <td colspan="3">납부신청일자</td>
                <td></td>

            </tr>
            <tr>
                <td colspan="4">㉔ 총산출세액( ㉒ + ㉓ )</td>
                <td><input type="text" id="totalCalculatedTax" class="currency-input" readonly></td>
                <td onclick="alert('상속세 연부연납입니다.');" style="cursor: pointer;">㊶ 연부연납</td>
                <td colspan="3"><input type="date" id="installmentPaymentDay"></td>
                <td><input type="text" id="installmentPayment" class="currency-input" placeholder=""></td>
            </tr>
            <tr>
                <td colspan="4" onclick="alert('가업상속공제와 영농상속공제에 대한 이행을 하지 못한 경우 이자상당액입니다.');" style="cursor: pointer;">㉕
                    이자상당액
                </td>
                <td><input type="text" id="interestAmount" class="currency-input" placeholder=""></td>
                <td onclick="alert('상속받은 재산으로 물납하는 경우입니다.');" style="cursor: pointer;">㊷ 물납</td>
                <td colspan="3"><input type="date" id="inKindPaymentDay"></td>
                <td><input type="text" id="paymentInKind" class="currency-input" placeholder=""></td>
            </tr>
            <tr>
                <td colspan="4">㉖ 문화재 등 징수유예세액
                    <button id="openModal2">입력</button>
                </td>
                <td><input type="text" id="culturalHeritageDeferredTax" class="currency-input" readonly></td>
                <td rowspan="2">현금</td>
                <td onclick="alert('분납 2개월입니다.');" style="cursor: pointer;">㊸ 분납</td>
                <td colspan="2"><input type="date" id="partialPaymentDay"></td>
                <td><input type="text" id="partialPayment" class="currency-input" placeholder=""></td>
            </tr>
            <tr>
                <td style="text-align: center; vertical-align: middle;" rowspan="9">세액 <br>공제</td>
                <td colspan="3"> ㉗ 계 (㉘ + ㉛ + ㉜ + ㉝ + ㉞)</td>
                <td><input type="text" id="totalDeductions" class="currency-input" readonly></td>
                <td>㊹ 신고납부</td>
                <td colspan="2"></td>
                <td><input type="text" id="finalPaymentAmount" class="currency-input" readonly></td>

            </tr>
            <tr>
                <td rowspan="3">㉘ 증여세액<br>공제</td>
                <td colspan="2">㉘ 소계 (㉙ + ㉚)</td>
                <td><input type="text" id="subtotal" class="currency-input" readonly></td>
                <td style="text-align: center; vertical-align: middle;" rowspan="5" colspan="5"> 「상속세 및 증여세법」 제67조 및 같은
                    법 시행령 제67 64 조제1
                    항에 따라<br> 상속세의 과세가액 및 과세표준을 신고하며, <strong>위
                        내용을 충분히 검토하였고 <br>신고인이 알고 있는 사실
                        을 그대로 적었음을 확인합니다.</strong>
                    년 월 일 <br>
                    신고인 서명 또는 인( )
                </td>
            </tr>
            <tr>
                <td colspan="2" onclick="alert('10년(5년)이내 상속인(상속인 외의 자)에게 증여 시 증여세 산출세액입니다.');"
                    style="cursor: pointer;">㉙ 「상속세 및 증여세법」<br>제28조
                </td>
                <td><input type="text" id="giftTaxInheritanceAct" class="currency-input" placeholder=""></td>
            </tr>
            <tr>
                <td colspan="2" onclick="alert('창업자에 대한 증여세 과세특례, 가업승계 증여세 특례 적용 시 증여세액 공제액입니다.');"
                    style="cursor: pointer;">㉚ 「조세특례제한법」<br>제30조의5 및 제30조의 6
                </td>
                <td><input type="text" id="giftTaxSpecialAct" class="currency-input" placeholder=""></td>
            </tr>
            <tr>

            </tr>
            <tr>
                <td colspan="3" onclick="alert('외국에 있는 상속재산에 대하여 외국법령에 의해 상속세를 부과받은 경우 일정액을 공제합니다.');"
                    style="cursor: pointer;">㉛ 외국납부세액공제 <br> 「상속세 및 증여세법」 제29조
                </td>
                <td><input type="text" id="foreignTaxCredit" class="currency-input" placeholder=""></td>

            <tr>
                <td colspan="3">㉜ 단기세액공제</td>
                <td><input type="text" id="shortTermTaxCredit" class="currency-input" placeholder=""></td>
                <td rowspan="2" colspan="5"> 세무대리인은 조세전문자격자로서 위 신고서를 성실하고
                    공정하게 <br> 작성하였음을 확인합니다.
                    세무대리인 서명 또는 인( )
                </td>
            </tr>

            </tr>
            <tr>
                <td colspan="3">㉝ 신고세액공제
                    <button id="openModal3">입력</button>
                </td>
                <td><input type="text" id="reportedTaxCredit" class="currency-input" readonly></td>
            </tr>
            <tr>
                <td colspan="3" onclick="alert('그 외 해당 사항이 있는 경우 입력합니다.');" style="cursor: pointer;">㉞ 그 밖의 공제</td>
                <td><input type="text" id="otherDeductions" class="currency-input" placeholder=""></td>
                <td style="text-align: center; vertical-align: middle;" colspan="5"><strong>세무서장</strong> 귀하</td>
            </tr>


        </table>

        <table>
            <tr>
                <td>신고인제출서류</td>
                <td>
                    <ol>
                        <li>상속세과세가액계산명세서(부표1) 1부</li>
                        <li>상속인별 상속재산 및 평가명세서(부표2) 1부</li>
                        <li>채무ㆍ공과금ㆍ장례비용 및 상속공제명세서(부표3) 1부</li>
                        <li>상속개시 전 1년 이내 재산처분ㆍ채무부담 내역 및 사용처소명명세서(부표4) 1부</li>
                        <li>영리법인 상속세 면제 및 납부 명세서(부표5) 1부</li>
                    </ol>
                </td>
                <td style="text-align: center; vertical-align: middle;" rowspan="2">수수료 없음</td>
            </tr>
            <tr>
                <td>담당공무원 확인사항</td>
                <td>
                    <ol>
                        <li>주민등록표등본</li>
                        <li>피상속인 및 상속인의 관계를 알 수 있는 가족관계등록부</li>
                    </ol>
                </td>
            </tr>
        </table>

        <table>
            <tr>
                <th colspan="3">행정정보 공동이용 동의서</th>
            </tr>
            <tr>
                <td colspan="3">본인은 이 건 업무처리와 관련하여 담당 공무원이 「전자정부법」
                    제36조제1항에 따른 행정정보의 공동이용을 통하여 위의 담당 공무원 확인사항을
                    확인하는<br> 것에 동의합니다. *동의하지 않는 경우에는 신고인이 직접 관련
                    서류를 제출해야 합니다.
                </td>
            </tr>
            <tr>
                <td>신고인</td>
                <td><input type="text" id="applicant_name"></td>
                <td> (서명 또는 인 )</td>
            </tr>
        </table>


        <!-- 모달 창들 -->
        <!-- 세대생략가산액 입력 모달 -->
        <div id="modal1" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" data-modal="modal1">&times;</span>
                <h3>㉓ 세대생략가산액 입력</h3>
                <p>자녀를 제외한 직계비속이 상속받은 경우 적용됩니다.<br>
                    산출세액 × (피상속인의 자녀를 제외한 직계비속이 상속받은 재산가액 / 총상속재산가액) × 30%(미성년자의 경우 40%)</p>
                <input type="text" id="modalGenerationSkippingSurtax" class="currency-input" placeholder="금액을 입력하세요">
                <br><br>
                <button data-apply="generationSkippingSurtax">반영</button>
            </div>
        </div>

        <!-- 문화재 등 징수유예세액 입력 모달 -->
        <div id="modal2" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" data-modal="modal2">&times;</span>
                <h3>㉖ 문화재 등 징수유예세액 입력</h3>
                <p>문화재 보호법에 따라 문화재를 상속받은 경우 상속세를 징수 유예합니다.<br>
                    징수유예세액 = 상속세 산출세액 × (해당 문화재 재산가액 / 상속재산)</p>
                <input type="text" id="modalCulturalHeritageDeferredTax" class="currency-input" placeholder="금액을 입력하세요">
                <br><br>
                <button data-apply="culturalHeritageDeferredTax">반영</button>
            </div>
        </div>

        <!-- 신고세액공제 입력 모달 -->
        <div id="modal3" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" data-modal="modal3">&times;</span>
                <h3>㉝ 신고세액공제 계산 결과</h3>
                <p>신고세액공제는 다음과 같이 계산됩니다:</p>
                <p>신고세액공제 = [총산출세액 - ㉖ 문화재 등 징수유예세액 - (㉘ 소계 + ㉛ 외국납부세액공제 + ㉜ 단기세액공제)] × 3%</p>
                <p>계산된 금액: <span id="calculatedReportedTaxCredit"></span> 원</p>
                <br>
                <button data-apply="reportedTaxCredit">반영</button>
            </div>
        </div>

        <!-- 영리법인면제분납부세액 입력 모달 -->
        <div id="modal4" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" data-modal="modal4">&times;</span>
                <h3>㉟ 영리법인면제분납부세액 입력</h3>
                <input type="text" id="modalProfitCorpTaxExemption" class="currency-input" placeholder="금액을 입력하세요">
                <br><br>
                <button data-apply="profitCorpTaxExemption">반영</button>
            </div>
        </div>


    </div>

    <!-- 로컬 스토리지 저장, 불러오기, 삭제 버튼 -->
    <div class="no-print" style="margin-top: 10px;">
        <button onclick="saveStep4Data()">저장 4</button>
        <button onclick="loadStep4Data()">불러오기 4</button>
        <button onclick="deleteStep4Data()">삭제 4</button>
    </div>


    <button class="no-print" onclick="nextStep(5)">다음</button>
    <button class="no-print" onclick="previousStep(3)">뒤로가기</button>
    <button onclick="printStep(4)">4단계 인쇄</button>

    <div class="print-hint no-print">
        <p>이 문서는 <strong>세로</strong> 방향으로 인쇄하세요.</p>
    </div>
</div>

<div id="step5" style="display: none;" class="step ">
    <div class="print-area">

        <h1>자진납부 납부서 작성 및 납부 안내</h1>

        <h2>1. 홈택스 접속 후 로그인</h2>
        <div class="image-container">
            <img src="https://tuzaga.com/wp-content/uploads/홈텍스자진납부1.png" alt="자진납부서 작성 화면">
        </div>
        <ol>
            <li><a href="https://www.hometax.go.kr" target="_blank">홈택스(https://www.hometax.go.kr)</a> 주소줄이 맞는지 확인하세요.
            </li>
            <li>홈택스 로그인 후 [납부] 메뉴에서 [자진납부]를 선택하세요.</li>
        </ol>

        <h2>2. 상속세 납부서 작성 및 납부방법</h2>
        <div class="image-container">
            <img src="https://tuzaga.com/wp-content/uploads/상속세-자진납부-2.png" alt="상속세 자진납부 화면">
        </div>
        <ol>
            <li>납부구분에는 "확정분 자납"을 선택하세요.</li>
            <li>세목은 32.상속세를 선택하세요.</li>
            <li>상속세 금액에 납부할 세금액을 입력하세요.</li>
            <li>납부기한은 사망일이 속하는 달의 마지막일로부터 6개월이 되는 날까지입니다. 예) 사망일이 2024년 3월 15일인 경우, 2024년 9월 30일까지입니다.</li>
            <li>납부하기를 선택하면 바로 납부할 수 있고, 납부서 출력을 선택하면 납부서를 출력할 수 있습니다.</li>
            <li>납부하고 나면 납부내역을 확인할 수 있습니다.</li>
        </ol>

        <h2>3. 주의사항</h2>
        <div class="note">
            <p class="highlight">홈택스 납부시간: 07:00~23:30</p>
            <ul>
                <li><strong>22시 이후 납부결과는 다음날 07시 이후 확인 가능</strong></li>
                <li>가상계좌 이체시간은 <strong>금융기관에 따라 차이가 있습니다</strong>.</li>
            </ul>
        </div>

        <p><span class="highlight">납부한 세금은 취소할 수 없으며, 세무서에 직접 연락하여 환급신청해야 합니다. 카드 관련 수수료는 납세자가 부담해야 합니다.</span></p>

        <ul>
            <li><strong>납부대행 수수료</strong>는 납부세액의 신용카드 <span class="highlight">0.8%</span>, 체크카드 <span class="highlight">0.5%</span>입니다.
            </li>
            <li>신용카드 할부 수수료는 별도이므로 각 신용카드사에 문의하시기 바랍니다.</li>
        </ul>

        <p>홈택스에 접속한 <span class="highlight">본인 명의의 계좌 또는 카드</span>로만 납부할 수 있습니다. 타인 명의 카드(또는 계좌)로 납부를 원하시는 경우, 해당
            <strong>카드(또는 계좌) 명의자로 홈택스 로그인 후 [타인세금 납부] 메뉴</strong>를 이용하세요.</p>

        <p>버튼을 선택하여도 팝업창이 안 뜰 경우, 사용 중인 브라우저에서 <strong>팝업차단을 해제</strong>하시기 바랍니다.</p>

        <ul>
            <li>예시: 익스플로러는 [인터넷옵션-개인정보-팝업차단 사용] 체크 해제</li>
        </ul>


    </div>

    <div>

        <button class="no-print" onclick="previousStep(4)">뒤로가기</button>
        <button onclick="printStep(5)">5단계 인쇄</button>
    </div>
    <script>

        // 다음 단계로 넘어가는 함수
        function nextStep(stepNum) {
            document.getElementById("step" + (stepNum - 1)).style.display = "none";
            document.getElementById("step" + stepNum).style.display = "block";
            // STEP3로 이동할 때 필드 업데이트
            if (stepNum === 3) {
                updateStep3Fields();
            }

            // step4로 이동할 때 필드 채우기
            if (stepNum === 4) {
                populateStep4Fields();
            }

        }

        function previousStep(stepNum) {
            document.getElementById("step" + (stepNum + 1)).style.display = "none";
            document.getElementById("step" + stepNum).style.display = "block";
        }


        // 인쇄 관련 스크립트
        function printStep(stepNum) {
            document.body.setAttribute('data-print-step', stepNum);
            window.print();
            document.body.removeAttribute('data-print-step');
        }

        function printAll() {
            document.body.setAttribute('data-print-all', 'true');
            window.print();
            document.body.removeAttribute('data-print-all');
        }


        // 자산구분, 종류, 평가기준에 따른 팝업창, 배열설정
        const assetTypes = [
            {code: "A11", name: "상속재산 : 상속인이 받은 상속재산"},
            {code: "A12", name: "상속재산 : 상속인외의 자가 받은  상속재산"},
            {code: "A13", name: "상속재산 : 상속개시전 처분재산"},
            {code: "A21", name: "증여재산가산 : 상속인에게 증여한 "},
            {code: "A22", name: "증여재산가산 : 상속인외의 자에게 증여한"},
            {code: "A23", name: "증여재산가산 : 창업자금으로 미리 증여한"},
            {code: "A24", name: "증여재산가산 : 가업승계주식을  미리 증여한"},
            {code: "B11", name: "비과세자산 : 금양임야"},
            {code: "B12", name: "비과세자산 : 공공단체 유증"},
            {code: "B13", name: "비과세자산 : 기타"},
            {code: "B21", name: "과세가액불산입 : 공익법인출연재산"},
            {code: "B22", name: "과세가액불산입 : 공익신탁재산"}
        ];

        const propertyTypes = [
            {code: "01", name: "현금"},
            {code: "02", name: "토지I : (순수토지)"},
            {code: "03", name: "토지II :[일반건물(07)의 부속토지]"},
            {code: "04", name: "개별주택 :(주택부수토지 포함)"},
            {code: "05", name: "공동주택: (부수토지 포함)"},
            {code: "06", name: "오피스텔ㆍ상업용건물 (부수토지 포함)"},
            {code: "07", name: "일반건물(부수토지 제외)"},
            {code: "08", name: "부동산을 취득할수 있는 권리"},
            {code: "09", name: "유가증권(상장)"},
            {code: "10", name: "유가증권(비상장)"},
            {code: "11", name: "금융재산( 현금, 유가증권제외)"},
            {code: "12", name: "기타재산"},
            {code: "13", name: "가상재산"},
            {code: "14", name: "서화골동품등"}
        ];

        const evaluationStandards = [
            {code: "01", name: "해당 재산의 매매거래가액 :   (상증법 60조)"},
            {code: "02", name: "해당 재산의 감정가액   :     (상증법 60조)"},
            {code: "03", name: "해당 재산의 수용보상가액  :   (상증법 60조)"},
            {code: "04", name: "해당 재산의 경매공매가액   :  (상증법 60조)"},
            {code: "05", name: "유사재산의 매매사례가액 등 :  (상증법 60조)"},
            {code: "06", name: "현금등가액            :      (상증법 60조)"},
            {code: "07", name: "저당권등평가특례가액  :       (상증법 60조)"},
            {code: "08", name: "기준시가등 보충적평가가액   : (상증법 61조부터 65조)"}
        ];


        function addRow() {
            const tbody = document.querySelector('#assetTable tbody');
            const rowCount = tbody.rows.length;
            const newRow = tbody.insertRow();
            const index = rowCount + 1;

            newRow.innerHTML = `
                <td><span class="assetTypeSelector selector">선택</span></td>
                <td><span class="propertyTypeSelector selector">선택</span></td>
                <td>
                    <div class="checkbox-container">
                        <label><input type="radio" name="isForeign${index}" value="yes">여</label>
                        <label><input type="radio" name="isForeign${index}" value="no">부</label>
                    </div>
                </td>
                <td><input type="text" name="foreignCountry"></td>
                <td><input type="text" name="location"></td>
                <td><input type="text" name="registrationNumber"></td>
                <td><input type="number" name="quantity" value="0"></td>
                <td><input type="number" name="price" value="0"></td>
                <td class="total">0</td>
                <td><span class="evaluationStandardSelector selector" style="display: flex; justify-content: center; align-items: center; height: 100%;">선택</span></td>
                <td><button onclick="deleteRow(this)">삭제</button></td>
            `;

            // 새로 추가된 행에 리스너 적용
            addRowListeners(newRow);

            // 팝업 선택 기능 적용
            setupSelector('.assetTypeSelector', 'assetTypeModal', 'assetTypeContent', assetTypes);
            setupSelector('.propertyTypeSelector', 'propertyTypeModal', 'propertyTypeContent', propertyTypes);
            setupSelector('.evaluationStandardSelector', 'evaluationStandardModal', 'evaluationStandardContent', evaluationStandards);

            calculateInheritDeductionTotal(newRow); // 새 행에 대한 총액 계산 초기화
        }


        // 첫 번째 행에도 리스너를 추가하기 위해 DOMContentLoaded 이벤트 사용
        document.addEventListener('DOMContentLoaded', function () {
            const firstRow = document.querySelector('#assetTable tbody tr'); // 첫 번째 행 선택
            if (firstRow) {
                addRowListeners(firstRow); // 첫 번째 행에 리스너 추가
            }
        });

        function addRowListeners(row) {
            const quantityInput = row.querySelector('input[name="quantity"]');
            const priceInput = row.querySelector('input[name="price"]');

            if (quantityInput && priceInput) {
                quantityInput.addEventListener('input', () => calculateRowTotal(row));
                priceInput.addEventListener('input', () => calculateRowTotal(row));
            }
        }


        function calculateRowTotal(row) {
            const quantity = parseFloat(row.querySelector('input[name="quantity"]').value) || 0;
            const price = parseFloat(row.querySelector('input[name="price"]').value) || 0;
            const total = quantity * price;
            row.querySelector('.total').textContent = total.toLocaleString();
            updateGrandTotal();
        }

        function updateGrandTotal() {
            const totalCells = document.querySelectorAll('.total');
            let grandTotal = 0;
            totalCells.forEach(cell => {
                grandTotal += parseFloat(cell.textContent.replace(/,/g, '')) || 0;
            });
            document.getElementById('grandTotal').textContent = grandTotal.toLocaleString();
        }

        function deleteRow(button) {
            const row = button.closest('tr');
            row.remove();
            updateGrandTotal();

        }

        //저장함수

        function saveAssetData() {
            const rows = document.querySelectorAll('#assetTable tbody tr');
            const data = []; // 자산 데이터를 저장할 배열
            let grandTotalValue = 0; // 전체 자산의 총액을 저장할 변수

            // 각 행의 데이터를 순차적으로 가져옴
            rows.forEach((row, index) => {
                const assetTypeElement = row.querySelector('.assetTypeSelector');
                const assetTypeName = assetTypeElement?.textContent || '';
                const assetTypeCode = assetTypeElement?.dataset.code || '';

                const propertyTypeElement = row.querySelector('.propertyTypeSelector');
                const propertyTypeName = propertyTypeElement?.textContent || '';
                const propertyTypeCode = propertyTypeElement?.dataset.code || '';

                const isForeign = row.querySelector(`input[name="isForeign${index + 1}"]:checked`)?.value || '';
                const foreignCountry = row.querySelector('input[name="foreignCountry"]').value || '';
                const location = row.querySelector('input[name="location"]').value || '';
                const registrationNumber = row.querySelector('input[name="registrationNumber"]').value || '';
                const quantity = parseFloat(row.querySelector('input[name="quantity"]').value) || 0;
                const price = parseFloat(row.querySelector('input[name="price"]').value) || 0;

                const evaluationStandardElement = row.querySelector('.evaluationStandardSelector');
                const evaluationStandardName = evaluationStandardElement?.textContent || '';
                const evaluationStandardCode = evaluationStandardElement?.dataset.code || '';

                const total = quantity * price; // 각 자산별 총액(수량 * 가격)

                // 전체 총액(grandTotal)에 각 자산의 총액을 더함
                grandTotalValue += total;

                // 자산 데이터를 배열에 저장
                data.push({
                    assetTypeName, assetTypeCode,
                    propertyTypeName, propertyTypeCode,
                    isForeign, foreignCountry, location,
                    registrationNumber, quantity, price,
                    evaluationStandardName, evaluationStandardCode, total
                });
            });

            // 데이터를 localStorage에 저장 (총액 포함)
            localStorage.setItem('assetData', JSON.stringify({
                assets: data,
                grandTotal: grandTotalValue
            }));

            alert(`Step 1 데이터가 저장되었습니다. 총액: ${grandTotalValue.toLocaleString()} 원`);
        }


        function loadAssetData() {
            const storedData = JSON.parse(localStorage.getItem('assetData'));
            if (!storedData) {
                alert('저장된 데이터가 없습니다.');
                return;
            }

            // 현재 어떤 스텝인지 확인
            if (document.getElementById('step1').style.display === 'block') {
                // step1: 테이블과 grandTotal 모두 반영
                const tbody = document.querySelector('#assetTable tbody');
                tbody.innerHTML = ''; // 기존 행 제거

                // 저장된 자산 데이터를 테이블에 추가
                storedData.assets.forEach((item, index) => {
                    const newRow = tbody.insertRow();
                    newRow.innerHTML = `
                <td><span class="assetTypeSelector selector">${item.assetTypeName}</span></td>
                <td><span class="propertyTypeSelector selector">${item.propertyTypeName}</span></td>
                <td>
                    <div class="checkbox-container">
                        <label><input type="radio" name="isForeign${index + 1}" value="yes" ${item.isForeign === 'yes' ? 'checked' : ''}>여</label>
                        <label><input type="radio" name="isForeign${index + 1}" value="no" ${item.isForeign === 'no' ? 'checked' : ''}>부</label>
                    </div>
                </td>
                <td><input type="text" name="foreignCountry" value="${item.foreignCountry}"></td>
                <td><input type="text" name="location" value="${item.location}"></td>
                <td><input type="text" name="registrationNumber" value="${item.registrationNumber}"></td>
                <td><input type="number" name="quantity" value="${item.quantity}"></td>
                <td><input type="number" name="price" value="${item.price}"></td>
                <td class="total">${item.total.toLocaleString()}</td>
                <td><span class="evaluationStandardSelector selector">${item.evaluationStandardName}</span></td>
                <td><button onclick="deleteRow(this)">삭제</button></td>
            `;
                    // 데이터셋에 코드 저장
                    const assetTypeElement = newRow.querySelector('.assetTypeSelector');
                    assetTypeElement.dataset.code = item.assetTypeCode || '';

                    const propertyTypeElement = newRow.querySelector('.propertyTypeSelector');
                    propertyTypeElement.dataset.code = item.propertyTypeCode || '';

                    const evaluationStandardElement = newRow.querySelector('.evaluationStandardSelector');
                    evaluationStandardElement.dataset.code = item.evaluationStandardCode || '';

                    // 새로 불러온 행에 리스너 적용
                    addRowListeners(newRow);
                });

                updateGrandTotal(); // 총액 업데이트
            }

            alert('데이터가 불러와졌습니다.');
        }


        // 개별 선택기에 대해 setupSelector 적용
        function setupSelectorForElement(selector, modalId, contentId, data) {
            const modal = document.getElementById(modalId);
            const content = document.getElementById(contentId);
            const closeBtn = modal.querySelector('.close');

//

            function createModalContent(selectedElement) {
                content.innerHTML = '';
                data.forEach(item => {
                    const button = document.createElement('button');
                    button.textContent = `${item.name} - ${item.code}`;
                    button.onclick = function () {
                        selectedElement.textContent = item.code; // 코드 표시
                        selectedElement.dataset.code = item.code;  // 코드 저장
                        modal.style.display = 'none'; // 모달 닫기
                        document.body.style.overflow = 'auto'; // 모달 닫힐 때 배경 스크롤 복구
                    };
                    content.appendChild(button);
                });
            }

            // 선택기 클릭 시 모달 열기
            selector.onclick = function (event) {
                event.stopPropagation();
                createModalContent(this);
                modal.style.display = 'block'; // 모달 열기
                document.body.style.overflow = 'hidden'; // 모달 열리면 배경 스크롤 비활성화
            };

            // 닫기 버튼 클릭 시 모달 닫기
            closeBtn.onclick = function () {
                modal.style.display = 'none'; // 모달 닫기
                document.body.style.overflow = 'auto'; // 배경 스크롤 복구
            };

            // 모달 외부 클릭 시 모달 닫기
            window.onclick = function (event) {
                if (event.target == modal) {
                    modal.style.display = 'none'; // 모달 닫기
                    document.body.style.overflow = 'auto'; // 배경 스크롤 복구
                }
            };
        }

        // 개별 행에 setupSelector 적용하는 함수
        function setupSelectorForRow(row) {
            const assetTypeSelector = row.querySelector('.assetTypeSelector');
            setupSelectorForElement(assetTypeSelector, 'asset', 'assetTypeContent', assetTypes);

            const propertyTypeSelector = row.querySelector('.propertyTypeSelector');
            setupSelectorForElement(propertyTypeSelector, 'propertyTypeModal', 'propertyTypeContent', propertyTypes);

            const evaluationStandardSelector = row.querySelector('.evaluationStandardSelector');
            setupSelectorForElement(evaluationStandardSelector, 'evaluationStandardModal', 'evaluationStandardContent', evaluationStandards);
        }


        // 데이터 삭제
        function clearAssetData() {
            localStorage.removeItem('assetData');
            alert('저장된 데이터가 삭제되었습니다.');
        }


        function setupSelector(selectorClass, modalId, contentId, data) {
            const selectors = document.querySelectorAll(selectorClass);
            const modal = document.getElementById(modalId);
            const content = document.getElementById(contentId);
            const closeBtn = modal.querySelector('.close');

            function createmodalContent(selectedElement) {
                content.innerHTML = '';
                data.forEach(item => {
                    const button = document.createElement('button');
                    button.textContent = `${item.name} - ${item.code}`;
                    button.onclick = function () {
                        selectedElement.textContent = item.code;
                        selectedElement.dataset.code = item.code;
                        modal.style.display = 'none';
                    };
                    content.appendChild(button);
                });
            }

            selectors.forEach(selector => {
                selector.onclick = function (event) {
                    event.stopPropagation();
                    createmodalContent(this);
                    modal.style.display = 'block';
                };
            });

            closeBtn.onclick = function () {
                modal.style.display = 'none';
            };

            window.onclick = function (event) {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            };
        }


        setupSelector('.assetTypeSelector', 'assetTypeModal', 'assetTypeContent', assetTypes);
        setupSelector('.propertyTypeSelector', 'propertyTypeModal', 'propertyTypeContent', propertyTypes);
        setupSelector('.evaluationStandardSelector', 'evaluationStandardModal', 'evaluationStandardContent', evaluationStandards);


        // 입력된 값을 천단위로 쉼표 구분하여 표시하는 함수
        document.querySelectorAll('.currency-input').forEach(input => {
            input.addEventListener('input', function () {
                // 입력값을 숫자로 변환 후 쉼표 추가
                let value = input.value.replace(/,/g, '');
                if (!isNaN(value) && value !== '') {
                    input.value = Number(value).toLocaleString();
                }
            });
        });

        //step2 의 함수
        // 테이블 행을 동적으로 생성하는 함수

        function generateTableRows(tableBodyId, rowCount, columns, classPrefix) {
            const tableBody = document.getElementById(tableBodyId);
            for (let i = 0; i < rowCount; i++) {
                const tr = document.createElement('tr');
                columns.forEach(col => {
                    const td = document.createElement('td');
                    if (col.type === 'select') {
                        const select = document.createElement('select');

                        // 빈 옵션 추가 (텍스트 없음)
                        const blankOption = document.createElement('option');
                        blankOption.value = '';
                        blankOption.textContent = ''; // 텍스트 없음
                        blankOption.selected = true; // 기본 선택 상태로 설정
                        select.appendChild(blankOption);

                        // 제공된 옵션 추가
                        col.options.forEach(opt => {
                            const option = document.createElement('option');
                            option.value = opt.value;
                            option.textContent = opt.text;
                            select.appendChild(option);
                        });

                        // 선택 시 클래스 추가/제거
                        select.addEventListener('change', function () {
                            if (this.value !== '') {
                                tr.classList.add('has-selection');
                            } else {
                                tr.classList.remove('has-selection');
                            }
                        });

                        td.appendChild(select);
                    } else if (col.type === 'input') {
                        const input = document.createElement('input');
                        input.type = 'text';
                        if (col.className) input.className = col.className;
                        if (col.onInput) input.setAttribute('onInput', col.onInput);
                        td.appendChild(input);
                    }
                    tr.appendChild(td);
                });
                tableBody.appendChild(tr);
            }
        }

        // 채무 테이블 행 생성
        generateTableRows('debtTableBody', 5, [
            {
                type: 'select', options: [
                    {value: 'finance', text: '금융채무'},
                    {value: 'personal', text: '개인사채'},
                    {value: 'deposit', text: '임대보증금'},
                    {value: 'other', text: '기타'}
                ]
            },
            {type: 'input'},
            {type: 'input'},
            {type: 'input'},
            {type: 'input'},
            {type: 'input'},
            {type: 'input', className: 'debt-amount', onInput: "formatAndCalculateDebtUtility(this, 'debt')"},
        ]);

        // 공과금 테이블 행 생성
        generateTableRows('utilityTableBody', 4, [
            {
                type: 'select', options: [
                    {value: '01', text: '01:국세'},
                    {value: '02', text: '02:지방세'},
                    {value: '03', text: '03:공공요금'},
                    {value: '04', text: '04:과태료/범칙금'},
                    {value: '05', text: '05:회비'},
                    {value: '06', text: '06:기타'}
                ]
            },
            {type: 'input'},
            {type: 'input'},
            {type: 'input', className: 'utility-amount', onInput: "formatAndCalculateDebtUtility(this, 'utility')"},
        ]);

        // 장례비용 테이블 행 생성
        generateTableRows('funeralTableBody', 4, [
            {type: 'input'},
            {type: 'input'},
            {type: 'input'},
            {type: 'input', className: 'funeral-amount', onInput: "formatAndCalculateDebtUtility(this, 'funeral')"},
        ]);

        // 숫자 포맷팅 함수
        function formatNumber(num) {
            return Math.floor(num).toLocaleString('ko-KR');
        }

        // 숫자 파싱 함수
        function parseNumber(numStr) {
            return parseInt(numStr.replace(/[^\d]/g, ''), 10) || 0;
        }

        // 채무, 공과금, 장례비용 합계 계산 함수

        function formatAndCalculateDebtUtility(input, type) {
            if (input) {
                let numValue = parseNumber(input.value);
                input.value = formatNumber(numValue);
            }

            let total = 0;
            document.querySelectorAll(`.${type}-amount`).forEach(input => {
                total += parseNumber(input.value);
            });
            const totalElement = document.getElementById(`${type}Total`);
            totalElement.textContent = formatNumber(total);

            // 합계 금액을 오른쪽 정렬
            totalElement.style.textAlign = 'right';
        }


        // 상속 공제 금액 포맷팅 및 합계 계산
        function formatAndCalculate() {
            const ids = ['businessInheritance', 'farmingInheritance', 'spouseInheritance', 'financialInheritance', 'disasterTaxDeduction', 'cohabitationDeduction'];
            ids.forEach(id => {
                const input = document.getElementById(id);
                input.value = formatNumber(parseNumber(input.value));
            });
            calculateInheritDeductionTotal();
        }

        // 모달 관련 변수 및 함수
        let currentmodalStep2 = '';

        function openmodalStep2(type) {
            currentmodalStep2 = type;
            const modalStep2 = document.getElementById('modalStep2');
            const modalStep2Title = document.getElementById('modalStep2Title');
            const modalStep2Description = document.getElementById('modalStep2Description');
            const modalStep2Input2 = document.getElementById('modalStep2Input2');

            modalStep2Input2.style.display = 'none'; // 추가 입력 필드를 숨김
            document.getElementById('modalStep2Input1').value = '';

            switch (type) {
                case 'child':
                    modalStep2Title.textContent = '자녀공제';
                    modalStep2Description.innerHTML = ': <strong>자녀수 * 1인당 5천만원</strong>';
                    break;
                case 'minor':
                    modalStep2Title.textContent = '미성년자공제';
                    modalStep2Description.innerHTML = ': <strong>미성년자들의 잔여연수(19세까지) 합산 * 1천만원</strong>';
                    break;
                case 'elder':
                    modalStep2Title.textContent = '연로자 공제';
                    modalStep2Description.innerHTML = ': <strong>연로자수 * 1인당 5천만원</strong>';
                    break;
                case 'disabled':
                    modalStep2Title.textContent = '장애인 공제';
                    modalStep2Description.innerHTML = ': <strong>장애인 기대여명 연수 합계 * 1천만원</strong>';
                    break;
            }
            modalStep2.classList.add('open');
        }

        function closemodalStep2() {
            document.getElementById('modalStep2').classList.remove('open');
        }

        function applymodalStep2() {
            const value1 = parseInt(document.getElementById('modalStep2Input1').value) || 0;
            const baseAmounts = {
                child: 50000000,
                minor: 10000000,
                elder: 50000000,
                disabled: 10000000
            };
            const calculatedValue = value1 * baseAmounts[currentmodalStep2];

            const deductionIds = {
                child: 'childDeduction',
                minor: 'minorDeduction',
                elder: 'elderDeduction',
                disabled: 'disabledDeduction'
            };

            document.getElementById(deductionIds[currentmodalStep2]).value = formatNumber(calculatedValue);
            closemodalStep2();
            calculateInheritDeductionTotal();
        }


        // 상속 공제 합계 계산 함수
        function calculateInheritDeductionTotal() {
            const ids = ['baseDeduction', 'childDeduction', 'minorDeduction', 'elderDeduction', 'disabledDeduction'];
            let subtotal = 0;
            ids.forEach(id => {
                subtotal += parseNumber(document.getElementById(id).value);
            });

            const totalDeduction = parseNumber(document.getElementById('totalDeduction').value);
            const maxTotal = Math.max(subtotal, totalDeduction);

            const additionalIds = ['businessInheritance', 'farmingInheritance', 'spouseInheritance', 'financialInheritance', 'disasterTaxDeduction', 'cohabitationDeduction'];
            let additionalTotal = 0;
            additionalIds.forEach(id => {
                additionalTotal += parseNumber(document.getElementById(id).value);
            });

            let finalTotal = maxTotal + additionalTotal;

            const deductionLimit = parseNumber(document.getElementById('deductionLimit').value);
            if (deductionLimit > 0) {
                finalTotal = Math.min(finalTotal, deductionLimit);
            }

            document.getElementById('totalDeductionSum').value = formatNumber(finalTotal);

            window.totalDeductionSumValue = finalTotal;// 전역 변수에 저장

        }

        // 데이터 저장 함수
        function saveDataToLocalStorage2() {
            const data = {};

            // 테이블 데이터 수집
            ['debt', 'utility', 'funeral'].forEach(type => {
                const rows = document.querySelectorAll(`#${type}TableBody tr`);
                data[`${type}Data`] = [];
                data[`${type}Total`] = 0; // 합계 초기화
                rows.forEach(row => {
                    const rowData = [];
                    row.querySelectorAll('input, select').forEach((input, idx) => {
                        rowData.push(input.value);
                        if (input.classList.contains(`${type}-amount`)) {
                            data[`${type}Total`] += parseNumber(input.value); // 합계 누적
                        }
                    });
                    data[`${type}Data`].push(rowData);
                });
            });

            // 상속 공제 데이터 수집
            const ids = ['baseDeduction', 'childDeduction', 'minorDeduction', 'elderDeduction', 'disabledDeduction', 'totalDeduction', 'businessInheritance', 'farmingInheritance', 'spouseInheritance', 'financialInheritance', 'disasterTaxDeduction', 'cohabitationDeduction', 'deductionLimit', 'totalDeductionSum'];
            data.inheritanceDeductions = {};
            ids.forEach(id => {
                data.inheritanceDeductions[id] = document.getElementById(id).value;
            });

            // 로컬 스토리지에 저장
            localStorage.setItem('step2Data', JSON.stringify(data));
            alert('데이터가 저장되었습니다.');
        }


        // parseNumber 함수 정의
        function parseNumber(value) {
            const number = parseFloat(value.replace(/,/g, ''));
            return isNaN(number) ? 0 : number;
        }


        // step2 데이터 불러오기 함수
        function loadDataFromLocalStorage2() {
            const data = JSON.parse(localStorage.getItem('step2Data'));
            if (!data) {
                alert('저장된 데이터가 없습니다.');
                return;
            }

            // 테이블 데이터 불러오기
            ['debt', 'utility', 'funeral'].forEach(type => {
                const rows = document.querySelectorAll(`#${type}TableBody tr`);
                data[`${type}Data`].forEach((rowData, index) => {
                    const inputs = rows[index].querySelectorAll('input, select');
                    inputs.forEach((input, idx) => {
                        input.value = rowData[idx];
                    });
                });
                formatAndCalculateDebtUtility(null, type);
            });

            // 상속 공제 데이터 불러오기
            const ids = ['baseDeduction', 'childDeduction', 'minorDeduction', 'elderDeduction', 'disabledDeduction', 'totalDeduction', 'businessInheritance', 'farmingInheritance', 'spouseInheritance', 'financialInheritance', 'disasterTaxDeduction', 'cohabitationDeduction', 'deductionLimit', 'totalDeductionSum'];
            ids.forEach(id => {
                if (data.inheritanceDeductions[id] !== undefined) {
                    document.getElementById(id).value = data.inheritanceDeductions[id];
                }
            });

            formatAndCalculate();
            alert('데이터를 불러왔습니다.');
        }

        // 데이터 삭제 함수
        function deleteDataFromLocalStorage2() {
            localStorage.removeItem('step2Data');
            alert('저장된 데이터가 삭제되었습니다.');
        }

        //STEP1과 STEP2의 데이터를 사용하여 STEP3의 필드들을 계산하고 채워주는 함수 작성
        // 로컬 스토리지에서 grandTotalValue를 가져오는 함수 정의 ,그러나 총액은 가져올 필요는 없으나 로컬스토지지 데이타는 가져와야함
        function getGrandTotalValue() {
            const storedData = JSON.parse(localStorage.getItem('assetData'));
            if (!storedData || !storedData.grandTotal) {
                return 0; // 데이터가 없으면 0 반환
            }
            return storedData.grandTotal;
        }

        // updateStep3Fields 함수 수정
        function updateStep3Fields() {
            // 자산 데이터 가져오기
            const field10Value = getAssetTotalByCodes(['A11', 'A12', 'B11', 'B12', 'B13', 'B21', 'B22']); // 사전증여 재산을 뺀  자산의 합계 (Field 10에 사용)
            const preInheritanceDisposalValue = getAssetTotalByCodes(['A13']); // Field 11
            const field12Value = field10Value + preInheritanceDisposalValue; // Field 12

            // 비과세 재산가액 계산
            const field14Value = getAssetTotalByCodes(['B11']); // Field 14
            const field15Value = getAssetTotalByCodes(['B12']); // Field 15
            const field16Value = getAssetTotalByCodes(['B13']); // Field 16
            const field13Value = field14Value + field15Value + field16Value; // Field 13

            // 과세가액 불산입 계산
            const field18Value = getAssetTotalByCodes(['B21']); // Field 18
            const field19Value = getAssetTotalByCodes(['B22']); // Field 19
            const field17Value = field18Value + field19Value; // Field 17

            // 공제금액 계산
            const {debtTotal, utilityTotal, funeralTotal} = getStep2Totals();
            const field22Value = utilityTotal; // 공과금
            const field23Value = funeralTotal; // 장례비용
            const field24Value = debtTotal; // 채무
            const field21Value = field22Value + field23Value + field24Value; // 공제금액 계

            // 가산하는 증여재산가액 계산
            const field26Value = getAssetTotalByCodes(['A21', 'A22']); // Field 26
            const field27Value = getAssetTotalByCodes(['A23']); // Field 27
            const field28Value = getAssetTotalByCodes(['A24']); // Field 28
            const field25Value = field26Value + field27Value + field28Value; // Field 25

            // 상속세 과세가액 계산
            const field29Value = field12Value - (field13Value + field17Value + field21Value) + field25Value;

            // 필드에 값 업데이트
            document.getElementById('field10').value = formatNumber(field10Value); // Field 10 (⑩ 상속재산가액)
            document.getElementById('field11').value = formatNumber(preInheritanceDisposalValue); // Field 11 (⑪ 상속개시전 처분재산등 산입액)
            document.getElementById('field12').value = formatNumber(field12Value); // Field 12 (⑫ 합계)

            document.getElementById('field14').value = formatNumber(field14Value);
            document.getElementById('field15').value = formatNumber(field15Value);
            document.getElementById('field16').value = formatNumber(field16Value);
            document.getElementById('field13').textContent = formatNumber(field13Value);

            document.getElementById('field18').value = formatNumber(field18Value);
            document.getElementById('field19').value = formatNumber(field19Value);
            document.getElementById('field17').textContent = formatNumber(field17Value);

            document.getElementById('field22').value = formatNumber(field22Value);
            document.getElementById('field23').value = formatNumber(field23Value);
            document.getElementById('field24').value = formatNumber(field24Value);
            document.getElementById('field21').textContent = formatNumber(field21Value);

            document.getElementById('field26').value = formatNumber(field26Value);
            document.getElementById('field27').value = formatNumber(field27Value);
            document.getElementById('field28').value = formatNumber(field28Value);
            document.getElementById('field25').textContent = formatNumber(field25Value);

            document.getElementById('field29').textContent = formatNumber(field29Value);

            // 전역 변수에 값 저장
            window.field29Value = field29Value;
        }

        function getAssetTotalByCodes(codes) {
            const storedData = JSON.parse(localStorage.getItem('assetData'));
            if (!storedData || !storedData.assets || !Array.isArray(storedData.assets)) {
                return 0; // 데이터가 없거나 구조가 올바르지 않으면 0 반환
            }

            // 자산구분코드에 해당하는 자산 필터링
            const assets = storedData.assets.filter(asset => codes.includes(asset.assetTypeCode));
            if (!assets || assets.length === 0) {
                return 0; // 해당하는 자산이 없으면 0 반환
            }

            // 해당 자산들의 total 값을 합산
            const total = assets.reduce((sum, asset) => {
                return sum + (asset.total || 0); // total 값이 없을 경우 0으로 취급
            }, 0);

            return total;
        }


        function getStep2Totals() {
            const data = JSON.parse(localStorage.getItem('step2Data'));
            if (!data) {
                return {debtTotal: 0, utilityTotal: 0, funeralTotal: 0};
            }
            const debtTotal = data.debtTotal || 0;
            const utilityTotal = data.utilityTotal || 0;
            const funeralTotal = data.funeralTotal || 0;
            return {debtTotal, utilityTotal, funeralTotal};
        }

        // step4 단계 함수

        function populateStep4Fields() {
            // 전역 변수에서 값 가져오기 (값이 없으면 0으로 대체)
            const field29Value = window.field29Value || 0;
            const totalDeductionSumValue = window.totalDeductionSumValue || 0;

            // step4의 필드에 값 설정
            document.getElementById('taxableInheritanceAmount').value = formatNumber(field29Value);
            document.getElementById('inheritanceDeductionAmount').value = formatNumber(totalDeductionSumValue);

            // 계산 함수 호출하여 계산 업데이트
            InheritanceTaxSelfAssessment();
        }


        // 천 단위 구분자 함수
        function formatCurrency(input) {
            let value = input.value.replace(/[^\d]/g, '');
            value = value.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            input.value = value;
        }

        // 모든 currency-input 클래스에 이벤트 리스너 추가
        document.querySelectorAll('.currency-input').forEach(input => {
            input.addEventListener('input', function () {
                formatCurrency(this);
                InheritanceTaxSelfAssessment(); // 값 변경 시 자동 계산
            });
        });

        // 모달 제어
        const modals = {
            modal1: document.getElementById("modal1"),
            modal2: document.getElementById("modal2"),
            modal3: document.getElementById("modal3"),
            modal4: document.getElementById("modal4"),
        };

        // 모달 열기 버튼
        document.getElementById("openModal1").onclick = function () {
            modals.modal1.style.display = "block";
        }
        document.getElementById("openModal2").onclick = function () {
            modals.modal2.style.display = "block";
        }
        document.getElementById("openModal3").onclick = function () {
            // 신고세액공제 계산
            calculateReportedTaxCredit();
            modals.modal3.style.display = "block";
        }
        document.getElementById("openModal4").onclick = function () {
            modals.modal4.style.display = "block";
        }

        // 모달 닫기 버튼
        document.querySelectorAll('.close').forEach(span => {
            span.onclick = function () {
                modals[span.getAttribute('data-modal')].style.display = "none";
            }
        });

        // 모달 반영 버튼
        document.querySelectorAll('button[data-apply]').forEach(button => {
            button.onclick = function () {
                const targetId = button.getAttribute('data-apply');
                if (targetId === "reportedTaxCredit") {
                    // 신고세액공제는 계산된 값을 사용
                    document.getElementById(targetId).value = parseInt(document.getElementById("calculatedReportedTaxCredit").innerText.replace(/,/g, '')).toLocaleString();
                } else {
                    const modalInputId = "modal" + targetId.charAt(0).toUpperCase() + targetId.slice(1);
                    document.getElementById(targetId).value = document.getElementById(modalInputId).value;
                }
                modals[button.parentElement.parentElement.id].style.display = "none";
                InheritanceTaxSelfAssessment(); // 모달에서 값 반영 시 자동 계산
            }
        });

        // 모달 외부 클릭 시 닫기
        window.onclick = function (event) {
            for (const key in modals) {
                if (event.target == modals[key]) {
                    modals[key].style.display = "none";
                }
            }
        }

        // 숫자 변환 함수
        function unformatCurrency(value) {
            return parseInt(value.replace(/,/g, '')) || 0;
        }

        // 세율 및 누진공제 계산 함수
        function getTaxRate(taxableBase) {
            if (taxableBase <= 100000000) {
                return {rate: 0.10, deduction: 0};
            } else if (taxableBase <= 500000000) {
                return {rate: 0.20, deduction: 10000000};
            } else if (taxableBase <= 1000000000) {
                return {rate: 0.30, deduction: 60000000};
            } else if (taxableBase <= 3000000000) {
                return {rate: 0.40, deduction: 160000000};
            } else {
                return {rate: 0.50, deduction: 460000000};
            }
        }

        // 신고세액공제 계산 함수
        function calculateReportedTaxCredit() {
            const totalCalculatedTax = unformatCurrency(document.getElementById("totalCalculatedTax").value);
            const culturalHeritageDeferredTax = unformatCurrency(document.getElementById("culturalHeritageDeferredTax").value);
            const subtotal = unformatCurrency(document.getElementById("subtotal").value);
            const foreignTaxCredit = unformatCurrency(document.getElementById("foreignTaxCredit").value);
            const shortTermTaxCredit = unformatCurrency(document.getElementById("shortTermTaxCredit").value);

            const baseForCredit = totalCalculatedTax - culturalHeritageDeferredTax - (subtotal + foreignTaxCredit + shortTermTaxCredit);
            let reportedTaxCredit = Math.floor(baseForCredit * 0.03);
            if (reportedTaxCredit < 0) reportedTaxCredit = 0;

            document.getElementById("calculatedReportedTaxCredit").innerText = reportedTaxCredit.toLocaleString();
        }

        // 계산 함수
        function InheritanceTaxSelfAssessment() {
            const taxableInheritanceAmount = unformatCurrency(document.getElementById("taxableInheritanceAmount").value);
            const inheritanceDeductionAmount = unformatCurrency(document.getElementById("inheritanceDeductionAmount").value);

            // 감정평가 수수료 최대 500만 원으로 제한
            let appraisalFee = unformatCurrency(document.getElementById("appraisalFee").value);
            if (appraisalFee > 5000000) {
                appraisalFee = 5000000;
                document.getElementById("appraisalFee").value = appraisalFee.toLocaleString();
            }

            let taxableBase = taxableInheritanceAmount - inheritanceDeductionAmount - appraisalFee;
            if (taxableBase <= 0) taxableBase = 0;
            document.getElementById("taxableBase").value = taxableBase.toLocaleString();

            // 세율 및 누진공제 계산
            const {rate, deduction} = getTaxRate(taxableBase);
            document.getElementById("taxRate").value = (rate * 100).toFixed(0) + "%";

            const calculatedTax = taxableBase * rate - deduction;
            document.getElementById("calculatedTax").value = Math.round(calculatedTax).toLocaleString();

            const generationSkippingSurtax = unformatCurrency(document.getElementById("generationSkippingSurtax").value);
            const totalCalculatedTax = calculatedTax + generationSkippingSurtax;
            document.getElementById("totalCalculatedTax").value = Math.round(totalCalculatedTax).toLocaleString();

            const interestAmount = unformatCurrency(document.getElementById("interestAmount").value);
            const culturalHeritageDeferredTax = unformatCurrency(document.getElementById("culturalHeritageDeferredTax").value);

            const giftTaxInheritanceAct = unformatCurrency(document.getElementById("giftTaxInheritanceAct").value);
            const giftTaxSpecialAct = unformatCurrency(document.getElementById("giftTaxSpecialAct").value);
            // 소계 계산 (㉘ = ㉙ + ㉚)
            const subtotal = giftTaxInheritanceAct + giftTaxSpecialAct;
            document.getElementById("subtotal").value = subtotal.toLocaleString();

            const foreignTaxCredit = unformatCurrency(document.getElementById("foreignTaxCredit").value);
            const shortTermTaxCredit = unformatCurrency(document.getElementById("shortTermTaxCredit").value);
            const reportedTaxCredit = unformatCurrency(document.getElementById("reportedTaxCredit").value);
            const otherDeductions = unformatCurrency(document.getElementById("otherDeductions").value);

            // 계 계산 (계 = ㉘ + ㉛ + ㉜ + ㉝ + ㉞)
            const totalDeductions = subtotal + foreignTaxCredit + shortTermTaxCredit + reportedTaxCredit + otherDeductions;
            document.getElementById("totalDeductions").value = totalDeductions.toLocaleString();

            const profitCorpTaxExemption = unformatCurrency(document.getElementById("profitCorpTaxExemption").value);

            let amountAfterDeductions = totalCalculatedTax + interestAmount - culturalHeritageDeferredTax - totalDeductions + profitCorpTaxExemption;
            if (amountAfterDeductions <= 0) amountAfterDeductions = 0;
            document.getElementById("amountAfterDeductions").value = Math.round(amountAfterDeductions).toLocaleString();

            const deferredBusinessInheritanceTax = unformatCurrency(document.getElementById("deferredBusinessInheritanceTax").value);
            const underReportingPenalty = unformatCurrency(document.getElementById("underReportingPenalty").value);
            const delayedPaymentPenalty = unformatCurrency(document.getElementById("delayedPaymentPenalty").value);

            const amountToBePaid = amountAfterDeductions - deferredBusinessInheritanceTax + underReportingPenalty + delayedPaymentPenalty;
            document.getElementById("amountToBePaid").value = Math.round(amountToBePaid).toLocaleString();

            const installmentPayment = unformatCurrency(document.getElementById("installmentPayment").value);
            const paymentInKind = unformatCurrency(document.getElementById("paymentInKind").value);
            const partialPayment = unformatCurrency(document.getElementById("partialPayment").value);

            const finalPaymentAmount = amountToBePaid - installmentPayment - paymentInKind - partialPayment;
            document.getElementById("finalPaymentAmount").value = Math.round(finalPaymentAmount).toLocaleString();
        }

        // 거주구분 라디오 버튼 이벤트 리스너 설정
        const residencyRadios = document.getElementsByName('residency');

        residencyRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                if (radio.value === '비거주자' && radio.checked) {
                    alert('국내자산만 상속과세');
                }
            });
        });


        // 스텝 4의 입력 필드 ID 목록
        const step4FieldIds = [
            'applicant_name', 'applicant_ssn', 'applicant_email',
            'applicant_address', 'relationship', 'applicant_phone_home',
            'applicant_phone_mobile', 'post_management_violation',
            'deceased_name', 'deceased_ssn', 'residency', 'deceased_address',
            'inheritance_cause', 'inheritance_date', 'agent_name',
            'agent_business_number', 'agent_management_number',
            'agent_office_phone', 'agent_mobile_phone',
            'taxableInheritanceAmount', 'inheritanceDeductionAmount',
            'appraisalFee', 'profitCorpTaxExemption', 'taxableBase',
            'amountAfterDeductions', 'deferredBusinessInheritanceTax',
            'taxRate', 'underReportingPenalty', 'delayedPaymentPenalty',
            'calculatedTax', 'amountToBePaid', 'generationSkippingSurtax',
            'totalCalculatedTax', 'installmentPaymentDay', 'installmentPayment',
            'interestAmount', 'inKindPaymentDay', 'paymentInKind',
            'culturalHeritageDeferredTax', 'partialPaymentDay', 'partialPayment',
            'totalDeductions', 'finalPaymentAmount', 'subtotal',
            'giftTaxInheritanceAct', 'giftTaxSpecialAct', 'foreignTaxCredit',
            'shortTermTaxCredit', 'reportedTaxCredit', 'otherDeductions'
            // 필요에 따라 추가 필드 ID를 여기에 추가하세요
        ];

        // 스텝 4 데이터 저장 함수
        function saveStep4Data() {
            const step4Data = {};
            step4FieldIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    if (element.type === 'checkbox') {
                        step4Data[id] = element.checked;
                    } else if (element.type === 'radio') {
                        const radios = document.getElementsByName(element.name);
                        radios.forEach(radio => {
                            if (radio.checked) {
                                step4Data[element.name] = radio.value;
                            }
                        });
                    } else {
                        step4Data[id] = element.value;
                    }
                }
            });
            localStorage.setItem('step4Data', JSON.stringify(step4Data));
            alert('스텝 4 데이터가 저장되었습니다.');
        }

        // 스텝 4 데이터 불러오기 함수
        function loadStep4Data() {
            const step4Data = JSON.parse(localStorage.getItem('step4Data'));
            if (step4Data) {
                step4FieldIds.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = step4Data[id] || false;
                        } else if (element.type === 'radio') {
                            const radios = document.getElementsByName(element.name);
                            radios.forEach(radio => {
                                if (radio.value === step4Data[element.name]) {
                                    radio.checked = true;
                                }
                            });
                        } else {
                            element.value = step4Data[id] || '';
                        }
                    }
                });
                alert('스텝 4 데이터가 불러와졌습니다.');
            } else {
                alert('저장된 데이터가 없습니다.');
            }
        }

        // 스텝 4 데이터 삭제 함수
        function deleteStep4Data() {
            localStorage.removeItem('step4Data');
            alert('스텝 4 데이터가 삭제되었습니다.');
        }


        //납부서 부분 함수
        document.querySelectorAll('.image-container img').forEach(img => {
            img.addEventListener('click', function () {
                this.classList.toggle('zoomed');
            });
        });

    </script>

</body>
</html>
