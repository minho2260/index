<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PC방 매출 환산표</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans KR', sans-serif;
        }

        body {
            background-color: #f5f5f5;
            padding: 20px;
            margin: 0;
            width: 100%;
        }

        /* 인쇄 스타일 */
        @media print {
            @page {
                size: A4 landscape; /* A4 가로 방향으로 인쇄 */
                margin: 0; /* 여백 완전 제거 */
            }
            
            /* 인쇄 시 버튼 숨기기 */
            button {
                display: none !important;
            }
            
            /* 인쇄 시 배경색 유지 */
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            /* 전체 크기 축소하여 A4 한 페이지에 맞추기 */
            body {
                padding: 0 !important;
                margin: 0 !important;
                background-color: white !important;
                display: flex !important;
                justify-content: center !important;
                align-items: center !important;
                min-height: 100vh !important;
                overflow: hidden !important;
                width: 100% !important;
            }
            
            .container, .calculator-container {
                width: 100% !important;
                max-width: 100% !important;
                padding: 5px !important;
                margin: 0 auto !important; /* 가운데 정렬 */
                transform-origin: center center !important; /* 중앙 기준 변환 */
                transform: scale(0.95) !important; /* 전체 컨텐츠 95% 크기로 축소 */
            }
            
            /* 폰트 크기 조정 */
            body, table, input, span, label {
                font-size: 9pt !important;
            }
            
            h1 {
                font-size: 14pt !important;
                margin: 5px 0 !important;
                text-align: center !important;
            }
            
            h2, h3 {
                font-size: 11pt !important;
                margin: 3px 0 !important;
            }
            
            /* 테이블 셀 크기 조정 */
            td, th {
                padding: 1px !important;
            }
            
            /* 입력 필드 높이 조정 */
            input {
                height: auto !important;
                padding: 1px 2px !important;
            }
            
            /* 가로 중앙 정렬을 위한 추가 설정 */
            .calculator-flex-container {
                justify-content: center !important;
                width: 100% !important;
                margin: 0 auto !important;
            }
            
            /* 1. 피시방 매출 환산법 섹션 확장 */
            .calculator-flex-container > div:first-child {
                width: 30% !important; /* 너비 증가 */
                min-width: 30% !important;
            }
            
            .calculator-flex-container > div:last-child {
                width: 70% !important;
            }
            
            /* 1번 섹션 내 입력 필드 너비 확장 */
            .calculator-flex-container > div:first-child input {
                width: 120px !important;
            }
            
            /* 인쇄 시 상품매출액 산출 식 섹션의 단위 텍스트 위치 조정 */
            .calculator-flex-container > div:first-child span {
                order: -1 !important;
                margin-right: 5px !important;
                margin-left: 0 !important;
            }
            
            .calculator-flex-container > div:first-child div {
                display: flex !important;
                flex-direction: row !important;
                align-items: center !important;
            }
        }

        .container {
            margin: 0 auto;
            width: 100%;
            background-color: white;
            padding: 15px 30px 30px 30px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        h2 {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        .input-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        label {
            font-weight: bold;
            color: #555;
        }

        input {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 14px;
            line-height: 1.2;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #0056b3;
        }

        .result-section {
            margin-top: 30px;
            border-top: 2px solid #eee;
            padding-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f8f9fa;
            font-weight: bold;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        .total-row {
            font-weight: bold;
            background-color: #e9ecef;
        }

        .game-cost-section {
            margin-bottom: 10px;
            padding: 2px;
            background-color: #f8f9fa;
            border-radius: 8px;
            display: flex;
            gap: 0;
            justify-content: flex-start;
        }

        .game-cost-table {
            flex: 1;
            width: 80%;
            border-collapse: collapse;
            margin-top: 10px;
            background-color: white;
        }

        .game-cost-table th,
        .game-cost-table td {
            padding: 8px;
            text-align: center;
            border: 1px solid #ddd;
        }

        .game-cost-table th:first-child,
        .game-cost-table td:first-child {
            text-align: center;
        }

        .game-cost-table th {
            background-color: #f8f9fa;
            font-weight: bold;
        }

        .game-cost-table tr:hover {
            background-color: #f5f5f5;
        }

        .game-cost-table td:last-child {
            text-align: center;
        }

        .calculation-formula {
            flex: 1;
            padding: 10px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .calculation-formula::before {
            content: '';
            position: absolute;
            left: -15px;
            top: 0;
            bottom: 0;
            width: 1px;
            background-color: #ddd;
        }

        .formula-item {
            margin-bottom: 10px;
            padding: 8px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }

        .formula-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .formula-content {
            color: #666;
            line-height: 1.6;
        }

        h3 {
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        /* 그 외 게임사별 매입금액 테이블 스타일 수정 */
        .other-game-companies-table {
            width: 50%; /* 95%에서 50%로 감소 - 상품매출 테이블과 동일하게 */
            border-collapse: collapse;
            margin-top: 10px;
            background-color: white;
            margin-left: 0; /* auto에서 0으로 변경 */
            margin-right: auto;
        }

        .other-game-companies-table th,
        .other-game-companies-table td {
            padding: 4px;
            text-align: center;
            border: 1px solid #ddd;
            height: 25px;
        }

        .other-game-companies-table th:first-child,
        .other-game-companies-table td:first-child {
            width: 150px; /* 게임사 열 */
            text-align: center;
        }

        .other-game-companies-table th:nth-child(2),
        .other-game-companies-table td:nth-child(2) {
            width: 80px; /* 100px에서 80px로 감소 - 상품매출 테이블과 동일하게 */
            text-align: right;
        }

        .other-game-companies-table th:nth-child(2) {
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>PC방 매출 환산표</h1>
        
        <div style="display: flex; flex-wrap: wrap; gap: 20px;">
            <!-- 섹션 1: 피시방 매출 환산법 -->
            <div style="flex: 1; min-width: 270px; min-height: auto;">
                <h2 style="text-align: left; color: #333; margin-bottom: 4px; font-size: 1.3em; font-weight: bold; border-bottom: 2px solid #3498db; padding-bottom: 4px;">1. 피시방 매출 환산법</h2>
                
                <div style="margin-bottom: 4px;">
                    <h3 style="color: #333; margin-bottom: 2px; font-size: 1.1em;">게임매입원가</h3>
                    <table class="game-cost-table" style="width: 100%; margin-bottom: 4px; font-size: 0.95em;">
                        <thead>
                            <tr>
                                <th style="padding: 2px;">게임사</th>
                                <th style="padding: 2px;">시간당 원가</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 2px;">(주)넥슨코리아</td>
                                <td style="padding: 2px;">220원</td>
                            </tr>
                            <tr>
                                <td style="padding: 2px;">라이엇게임즈코리아</td>
                                <td style="padding: 2px;">204원</td>
                            </tr>
                            <tr>
                                <td style="padding: 2px;">블리자드엔터테인먼트</td>
                                <td style="padding: 2px;">218원</td>
                            </tr>
                            <tr>
                                <td style="padding: 2px;">(주)엔씨소프트</td>
                                <td style="padding: 2px;">234원</td>
                            </tr>
                            <tr>
                                <td style="padding: 2px;">(주)카카오게임즈</td>
                                <td style="padding: 2px;">198원</td>
                            </tr>
                            <tr>
                                <td style="padding: 2px;">그외</td>
                                <td style="padding: 2px;">200원</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div style="margin-bottom: 4px;">
                    <h3 style="color: #333; margin-bottom: 2px; font-size: 1.1em;">게임매출액 산출 식</h3>
                    <div class="formula-item" style="margin-bottom: 2px; padding: 4px; background-color: #f8f9fa; border-radius: 4px;">
                        <div class="formula-content" style="font-size: 0.9em;">
                            <p style="font-weight: bold;">게임사별 매입 공급가액 ÷ 시간당 원가 = 게임 매입 시간<br>
                            게임사별 게임 매입 시간 합계 × 게임료 = 서비스 매출</p>
                        </div>
                    </div>
                    <div class="formula-item" style="background-color: #fff3cd; border: 1px solid #ffeeba; padding: 4px; border-radius: 4px;">
                        <div class="formula-content" style="font-size: 0.9em;">
                            <p style="font-weight: bold;">※ 게임료는 실제보다 50~100원 낮게 </p>
                            <p style="font-weight: bold;">※ 게임매입4배와 시간당환산금액 중 작은 금액을 서비스매출 신고</p>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 style="color: #333; margin-bottom: 5px; font-size: 1.2em; font-weight: bold;">상품매출액 산출 식  (공급대가)</h3>
                    <div style="display: flex; flex-direction: column; gap: 8px; padding: 10px; background-color: #f8f9fa; border-radius: 5px;">
                        <div style="display: flex; align-items: center;">
                            <label style="width: 160px; margin-right: 15px; font-size: 1.1em; font-weight: bold; white-space: nowrap;">카드매출</label>
                            <div style="display: flex; align-items: center;">
                                <input type="text" id="cardSales" style="width: 110px; appearance: textfield; font-size: 15px; text-align: right; padding: 5px 8px; line-height: 1.3; background-color: #ffffc0; border: 1px solid #ddd; border-radius: 4px;" oninput="formatNumber(this); calculateCashSales();">
                            </div>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <label style="width: 160px; margin-right: 15px; font-size: 1.1em; font-weight: bold; white-space: nowrap;">배율</label>
                            <div style="display: flex; align-items: center;">
                                <input type="text" id="ratio" style="width: 110px; appearance: textfield; font-size: 15px; text-align: right; padding: 5px 8px; line-height: 1.3; background-color: #ffffc0; border: 1px solid #ddd; border-radius: 4px;" oninput="formatNumber(this); calculateCashSales();">
                                <span style="font-size: 15px; margin-left: 3px;">%</span>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <label style="width: 160px; margin-right: 15px; font-size: 1.1em; font-weight: bold; white-space: nowrap;">현금영수증매출</label>
                            <div style="display: flex; align-items: center;">
                                <input type="text" id="cashReceiptSales" style="width: 110px; appearance: textfield; font-size: 15px; text-align: right; padding: 5px 8px; line-height: 1.3; background-color: #ffffc0; border: 1px solid #ddd; border-radius: 4px;" oninput="formatNumber(this); calculateTotalSales();">
                            </div>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <label style="width: 160px; margin-right: 15px; font-size: 1.1em; font-weight: bold; white-space: nowrap;">현금매출</label>
                            <div style="display: flex; align-items: center;">
                                <input type="text" id="cashSales" style="width: 110px; appearance: textfield; font-size: 15px; text-align: right; padding: 5px 8px; line-height: 1.3; border: 1px solid #ddd; border-radius: 4px;" readonly>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <label style="width: 160px; margin-right: 15px; font-size: 1.1em; font-weight: bold; white-space: nowrap;">현금매출 (공급가액)</label>
                            <div style="display: flex; align-items: center;">
                                <input type="text" id="cashSalesSupplyPrice" style="width: 110px; appearance: textfield; font-size: 15px; text-align: right; padding: 5px 8px; line-height: 1.3; border: 1px solid #ddd; border-radius: 4px;" readonly>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <label style="width: 160px; margin-right: 15px; font-size: 1.1em; font-weight: bold; white-space: nowrap;">총 매출 (공급가액)</label>
                            <div style="display: flex; align-items: center;">
                                <input type="text" id="totalSales" style="width: 110px; appearance: textfield; font-size: 15px; text-align: right; padding: 5px 8px; line-height: 1.3; border: 1px solid #ddd; border-radius: 4px;" readonly>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <label style="width: 160px; margin-right: 15px; font-size: 1.1em; font-weight: bold; white-space: nowrap;">상품매출 (공급가액)</label>
                            <div style="display: flex; align-items: center;">
                                <input type="text" id="productSales" style="width: 110px; appearance: textfield; font-size: 15px; text-align: right; padding: 5px 8px; line-height: 1.3; border: none; border-radius: 4px; background-color: transparent;">
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <label style="width: 160px; margin-right: 15px; font-size: 1.3em; white-space: nowrap; text-align: right;">마진율:</label>
                            <div style="display: flex; align-items: center;">
                                <input type="text" id="marginRate" style="width: 110px; appearance: textfield; font-size: 15px; text-align: right; padding: 5px 8px; line-height: 1.3; background-color: #f0f8ff; border: 1px solid #4682b4; border-radius: 4px; color: #000;" value="0" readonly>
                                <span style="font-size: 20px; margin-left: 3px; margin-right: 10px;">%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 섹션 2: 상호 (서비스 매출) -->
            <div style="flex: 3; min-width: 750px; min-height: auto;">
                <div style="display: flex; align-items: center; margin-bottom: 5px; border-bottom: 2px solid #e74c3c; padding-bottom: 5px;">
                    <label style="font-size: 1.2em; font-weight: bold; color: #333; margin-right: 10px;">2. 상호:</label>
                    <input type="text" id="shopName" style="width: 200px; font-size: 1.2em; padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px; background-color: #ffffc0;" placeholder="">
                </div>
                
                <div>
                    <h3 style="color: #333; margin-bottom: -5px; font-size: 1em;">서비스 매출</h3>
                    <div style="display: flex; gap: 15px; align-items: flex-start;">
                        <table class="game-cost-table" style="width: 65%; font-size: 0.95em;">
                            <thead>
                                <tr>
                                    <th style="width: 180px; padding: 5px; height: 28px;">게임사</th>
                                    <th style="width: 80px; padding: 5px; height: 28px;">시간당원가</th>
                                    <th style="width: 100px; padding: 5px; height: 28px;">공급가액</th>
                                    <th style="width: 70px; padding: 5px; height: 28px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">게임매입시간</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 5px; height: 28px;">(주)넥슨코리아</td>
                                    <td style="padding: 5px; height: 28px;">220원</td>
                                    <td style="padding: 0; height: 28px;"><input type="text" style="width: 100%; height: 100%; text-align: right; border: none; background-color: #ffffc0; font-size: 0.95em; padding: 5px; box-sizing: border-box;" oninput="formatNumber(this); calculateGamePurchaseTime(this); calculateTotals()"></td>
                                    <td style="padding: 5px; height: 28px;">0</td>
                                </tr>
                                <tr>
                                    <td style="padding: 5px; height: 28px;">라이엇게임즈코리아</td>
                                    <td style="padding: 5px; height: 28px;">204원</td>
                                    <td style="padding: 0; height: 28px;"><input type="text" style="width: 100%; height: 100%; text-align: right; border: none; background-color: #ffffc0; font-size: 0.95em; padding: 5px; box-sizing: border-box;" oninput="formatNumber(this); calculateGamePurchaseTime(this); calculateTotals()"></td>
                                    <td style="padding: 5px; height: 28px;">0</td>
                                </tr>
                                <tr>
                                    <td style="padding: 5px; height: 28px;">블리자드엔터테인먼트</td>
                                    <td style="padding: 5px; height: 28px;">218원</td>
                                    <td style="padding: 0; height: 28px;"><input type="text" style="width: 100%; height: 100%; text-align: right; border: none; background-color: #ffffc0; font-size: 0.95em; padding: 5px; box-sizing: border-box;" oninput="formatNumber(this); calculateGamePurchaseTime(this); calculateTotals()"></td>
                                    <td style="padding: 5px; height: 28px;">0</td>
                                </tr>
                                <tr>
                                    <td style="padding: 5px; height: 28px;">(주)엔씨소프트</td>
                                    <td style="padding: 5px; height: 28px;">234원</td>
                                    <td style="padding: 0; height: 28px;"><input type="text" style="width: 100%; height: 100%; text-align: right; border: none; background-color: #ffffc0; font-size: 0.95em; padding: 5px; box-sizing: border-box;" oninput="formatNumber(this); calculateGamePurchaseTime(this); calculateTotals()"></td>
                                    <td style="padding: 5px; height: 28px;">0</td>
                                </tr>
                                <tr>
                                    <td style="padding: 5px; height: 28px;">(주)카카오게임즈</td>
                                    <td style="padding: 5px; height: 28px;">198원</td>
                                    <td style="padding: 0; height: 28px;"><input type="text" style="width: 100%; height: 100%; text-align: right; border: none; background-color: #ffffc0; font-size: 0.95em; padding: 5px; box-sizing: border-box;" oninput="formatNumber(this); calculateGamePurchaseTime(this); calculateTotals()"></td>
                                    <td style="padding: 5px; height: 28px;">0</td>
                                </tr>
                                <tr>
                                    <td style="padding: 5px; height: 28px;">그외</td>
                                    <td style="padding: 5px; height: 28px;">200원</td>
                                    <td style="padding: 0; height: 28px;"><input type="text" style="width: 100%; height: 100%; text-align: right; border: none; background-color: #ffffff; font-size: 0.95em; padding: 5px; box-sizing: border-box;" oninput="formatNumber(this); calculateGamePurchaseTime(this); calculateTotals()"></td>
                                    <td style="padding: 5px; height: 28px;">0</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <!-- 계산 영역을 테이블 오른쪽으로 이동 -->
                        <div style="background-color: #f8f9fa; padding: 12px; border-radius: 5px; width: 37%;">
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <label style="font-size: 1.1em; white-space: nowrap; width: 120px; text-align: right;">총 공급금액:</label>
                                    <input type="text" id="totalSupplyPrice" style="width: 150px; text-align: right; border: none; background: transparent; font-size: 1.15em;" readonly>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <label style="font-size: 1.1em; white-space: nowrap; width: 120px; text-align: right;">총 매입시간:</label>
                                    <input type="text" id="totalGamePurchaseTime" style="width: 150px; text-align: right; border: none; background: transparent; font-size: 1.15em;" readonly>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <label style="font-size: 1.3em; white-space: nowrap; width: 120px; text-align: right; font-weight: bold;">게임료:</label>
                                    <input type="text" id="gameFee" style="width: 150px; text-align: right; border: 1px solid #777; background-color: #ffffc0; font-size: 1.35em; padding: 5px 8px;" oninput="formatNumber(this); calculateServiceSales()">
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <label style="font-size: 1.1em; white-space: nowrap; width: 120px; text-align: right;">시간환산기준:</label>
                                    <input type="text" id="timeBasedSales" style="width: 150px; text-align: right; border: none; background: transparent; font-size: 1.15em;" readonly>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <label style="font-size: 1.1em; white-space: nowrap; width: 120px; text-align: right;">매입<input type="text" id="supplyMultiplier" style="width: 30px; text-align: center; border: 1px solid #777; background-color: #ffffc0; font-size: 1em; margin: 0 2px;" value="4" oninput="formatNumber(this); calculateServiceSales()">배기준:</label>
                                    <input type="text" id="supplyX4Sales" style="width: 150px; text-align: right; border: none; background: transparent; font-size: 1.15em;" readonly>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <label style="font-size: 1.3em; white-space: nowrap; width: 120px; text-align: right; font-weight: bold;">서비스 매출:</label>
                                    <input type="text" id="serviceSales" style="width: 150px; text-align: right; border: 1px solid #777; background-color: #ffffc0; font-size: 1.35em; padding: 5px 8px;" oninput="formatNumber(this)">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: -10px;">
                        <h3 style="color: #333; margin-bottom: -5px; font-size: 1em;">그 외 게임사별 매입금액</h3>
                        <div style="display: flex; gap: 15px; align-items: flex-start;">
                            <table class="other-game-companies-table game-purchase-table" style="font-size: 0.95em;">
                                <thead>
                                    <tr>
                                        <th style="width: 80px;">게임사</th>
                                        <th>공급가액</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="padding: 0;"><input type="text" style="width: 100%; text-align: center; font-size: 1em; border: none; background-color: #ffffc0;"></td>
                                        <td style="padding: 0;"><input type="text" style="width: 100%; text-align: right; font-size: 1em; border: none; background-color: #ffffc0;" oninput="formatNumber(this); calculateOtherGameCompanyTotals()"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 0;"><input type="text" style="width: 100%; text-align: center; font-size: 1em; border: none; background-color: #ffffc0;"></td>
                                        <td style="padding: 0;"><input type="text" style="width: 100%; text-align: right; font-size: 1em; border: none; background-color: #ffffc0;" oninput="formatNumber(this); calculateOtherGameCompanyTotals()"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 0;"><input type="text" style="width: 100%; text-align: center; font-size: 1em; border: none; background-color: #ffffc0;"></td>
                                        <td style="padding: 0;"><input type="text" style="width: 100%; text-align: right; font-size: 1em; border: none; background-color: #ffffc0;" oninput="formatNumber(this); calculateOtherGameCompanyTotals()"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 0;"><input type="text" style="width: 100%; text-align: center; font-size: 1em; border: none; background-color: #ffffc0;"></td>
                                        <td style="padding: 0; position: relative;">
                                            <input type="text" style="width: 100%; text-align: right; font-size: 1em; border: none; background-color: #ffffc0;" oninput="formatNumber(this); calculateOtherGameCompanyTotals()">
                                            <button onclick="addOtherGameCompanyRow()" style="position: absolute; right: -35px; top: 50%; transform: translateY(-50%); padding: 3px 6px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8em;">+</button>
                                            <button onclick="deleteOtherGameCompanyRow()" style="position: absolute; right: -65px; top: 50%; transform: translateY(-50%); padding: 3px 6px; background-color: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8em;">-</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div style="margin-top: 10px;">
                        <h3 style="color: #333; margin-bottom: -10px; font-size: 1.2em;">상품매출</h3>
                        <div style="display: flex; gap: 15px; align-items: flex-start;">
                            <table class="other-game-companies-table product-sales-table" style="font-size: 0.95em;">
                                <thead>
                                    <tr>
                                        <th>유통사</th>
                                        <th>공급가액</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="padding: 0; height: 25px;"><input type="text" style="width: 100%; height: 100%; text-align: center; border: none; background-color: #ffffc0; font-size: 0.95em; padding: 4px; box-sizing: border-box;"></td>
                                        <td style="padding: 0; height: 25px;"><input type="text" class="product-price-input" style="width: 100%; height: 100%; text-align: right; border: none; background-color: #ffffc0; font-size: 0.95em; padding: 4px; box-sizing: border-box;" oninput="formatNumber(this); calculateProductTotals()"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 0; height: 25px;"><input type="text" style="width: 100%; height: 100%; text-align: center; border: none; background-color: #ffffc0; font-size: 0.95em; padding: 4px; box-sizing: border-box;"></td>
                                        <td style="padding: 0; height: 25px;"><input type="text" class="product-price-input" style="width: 100%; height: 100%; text-align: right; border: none; background-color: #ffffc0; font-size: 0.95em; padding: 4px; box-sizing: border-box;" oninput="formatNumber(this); calculateProductTotals()"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 0; height: 25px;"><input type="text" style="width: 100%; height: 100%; text-align: center; border: none; background-color: #ffffc0; font-size: 0.95em; padding: 4px; box-sizing: border-box;"></td>
                                        <td style="padding: 0; height: 25px;"><input type="text" class="product-price-input" style="width: 100%; height: 100%; text-align: right; border: none; background-color: #ffffc0; font-size: 0.95em; padding: 4px; box-sizing: border-box;" oninput="formatNumber(this); calculateProductTotals()"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 0; height: 25px;"><input type="text" style="width: 100%; height: 100%; text-align: center; border: none; background-color: #ffffc0; font-size: 0.95em; padding: 4px; box-sizing: border-box;"></td>
                                        <td style="padding: 0; height: 25px; position: relative;">
                                            <input type="text" class="product-price-input" style="width: 100%; height: 100%; text-align: right; border: none; background-color: #ffffc0; font-size: 0.95em; padding: 4px; box-sizing: border-box;" oninput="formatNumber(this); calculateProductTotals()">
                                            <button onclick="addProductRow()" style="position: absolute; right: -35px; top: 50%; transform: translateY(-50%); padding: 3px 6px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8em;">+</button>
                                            <button onclick="deleteProductRow()" style="position: absolute; right: -65px; top: 50%; transform: translateY(-50%); padding: 3px 6px; background-color: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8em;">-</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <!-- 상품매출 계산 영역 -->
                            <div style="background-color: #f8f9fa; padding: 12px; border-radius: 5px; width: 45%; margin-top: -120px; margin-left: -47px;">
                                <div style="display: flex; flex-direction: column; gap: 8px;">
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <label style="font-size: 1.1em; white-space: nowrap; width: 130px; text-align: right;">총 유통매입가액:</label>
                                        <input type="text" id="totalDistributionPrice" style="width: 150px; text-align: right; border: none; background: transparent; font-size: 1.15em;" readonly>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <label style="font-size: 1.1em; white-space: nowrap; width: 130px; text-align: right;">마진율:</label>
                                        <div>
                                            <input type="text" id="productMarginRate" style="width: 120px; text-align: right; border: none; background-color: transparent; font-size: 1.1em; padding: 4px 6px;" oninput="formatNumber(this); calculateProductSales()">
                                            <span style="font-size: 1.1em;">%</span>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <label style="font-size: 1.3em; white-space: nowrap; width: 130px; text-align: right; font-weight: bold;">상품매출:</label>
                                        <input type="text" id="finalProductSales" style="width: 150px; text-align: right; border: 1px solid #777; background-color: #ffffc0; font-size: 1.3em; padding: 4px 6px;" oninput="formatNumber(this)">
                                    </div>
                                    
                                    <div style="margin-top: 20px; border-top: 1px solid #ddd; padding-top: 15px;">
                                        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 8px;">
                                            <label style="font-size: 1.1em; white-space: nowrap; width: 160px; text-align: right;">총매출:</label>
                                            <input type="text" id="totalRevenue" style="width: 120px; text-align: right; border: 1px solid #777; background-color: #f9f9f9; font-size: 1.1em; padding: 4px 6px;" readonly>
                                        </div>
                                        
                                        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 8px;">
                                            <label style="font-size: 1.1em; white-space: nowrap; width: 160px; text-align: right;">신용카드발행세액공제:</label>
                                            <input type="text" id="creditCardTaxDeduction" style="width: 120px; text-align: right; border: 1px solid #777; background-color: #ffffc0; font-size: 1.1em; padding: 4px 6px;" oninput="formatNumber(this)">
                                        </div>
                                        
                                        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 8px;">
                                            <label style="font-size: 1.1em; white-space: nowrap; width: 160px; text-align: right;">5억/7.5억:</label>
                                            <input type="text" id="revenueDivision" style="width: 120px; text-align: right; border: 1px solid #777; background-color: #f9f9f9; font-size: 1.1em; padding: 4px 6px;" value="0.667" readonly>
                                        </div>
                                        
                                        <div style="display: flex; align-items: center; gap: 20px;">
                                            <label style="font-size: 1.6em; white-space: nowrap; width: 160px; text-align: right; font-weight: bold;">환산매출:</label>
                                            <input type="text" id="convertedRevenue" style="width: 120px; text-align: right; border: 1px solid #777; background-color: #f9f9f9; font-size: 1.1em; padding: 4px 6px;" readonly>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 저장/삭제 버튼 추가 -->
                <div style="text-align: right; margin: 20px;">
                    <button onclick="saveData()" style="background-color: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px;">저장하기</button>
                    <button onclick="clearData()" style="background-color: #f44336; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;">삭제하기</button>
                </div>

            </div>
        </div>
    </div>

    <script>
        function formatNumber(input) {
            // 숫자가 아닌 문자 제거
            let value = input.value.replace(/[^\d.]/g, '');
            
            // 소수점이 여러 개인 경우 첫 번째만 유지
            if ((value.match(/\./g) || []).length > 1) {
                value = value.replace(/\.+$/, '');
            }
            
            // 천 단위 구분자 추가
            if (value) {
                const parts = value.split('.');
                parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                value = parts.join('.');
            }
            
            input.value = value;
        }

        // 게임사별 시간당 원가를 반환하는 함수
        function getGameHourlyCost(gameName) {
            const gameHourlyCosts = {
                '(주)넥슨코리아': 220,
                '라이엇게임즈코리아': 204,
                '블리자드엔터테인먼트': 218,
                '(주)엔씨소프트': 234,
                '(주)카카오게임즈': 198,
                '그외': 200
            };
            
            return gameHourlyCosts[gameName] || 200; // 기본값은 200원
        }

        function calculateGamePurchaseTime(input) {
            // 입력된 게임사 행 찾기
            const row = input.closest('tr');
            
            // 게임사 이름 얻기
            const gameName = row.cells[0].textContent.trim();
            
            // 시간당 원가 찾기 (해당 게임사에 해당하는)
            const gameHourlyCost = getGameHourlyCost(gameName);
            
            // 공급가액 가져오기
            const supplyPrice = parseFloat(input.value.replace(/,/g, '')) || 0;
            
            // 게임매입시간 계산 (공급가액 / 시간당 원가)
            const gamePurchaseTime = gameHourlyCost !== 0 ? Math.round(supplyPrice / gameHourlyCost) : 0;
            
            // 결과를 표시할 셀
            row.cells[3].textContent = gamePurchaseTime.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        function calculateCashSales() {
            const cardSalesInput = document.getElementById('cardSales');
            const ratioInput = document.getElementById('ratio');
            const cashSalesInput = document.getElementById('cashSales');
            const cashSalesSupplyPriceInput = document.getElementById('cashSalesSupplyPrice');

            // 숫자에서 쉼표 제거
            const cardSales = parseFloat(cardSalesInput.value.replace(/,/g, '')) || 0;
            const ratio = parseFloat(ratioInput.value.replace(/,/g, '')) || 0;

            // 계산: 카드매출 * (배율 / 100)
            let result = cardSales * (ratio / 100);

            // 천의 자리까지 반올림
            result = Math.round(result / 1000) * 1000;

            // 결과를 천 단위 구분자로 포맷팅
            if (result) {
                cashSalesInput.value = result.toLocaleString();
                
                // 공급가액 계산 (공급대가 / 1.1)
                const supplyPrice = Math.round(result / 1.1);
                cashSalesSupplyPriceInput.value = supplyPrice.toLocaleString();
                
                // 총 매출 계산
                calculateTotalSales();
            } else {
                cashSalesInput.value = '';
                cashSalesSupplyPriceInput.value = '';
                calculateTotalSales();
            }
        }

        function calculateTotalSales() {
            const cardSalesInput = document.getElementById('cardSales');
            const cashReceiptSalesInput = document.getElementById('cashReceiptSales');
            const cashSalesSupplyPriceInput = document.getElementById('cashSalesSupplyPrice');
            const totalSalesInput = document.getElementById('totalSales');

            // 숫자에서 쉼표 제거
            const cardSales = parseFloat(cardSalesInput.value.replace(/,/g, '')) || 0;
            const cashReceiptSales = parseFloat(cashReceiptSalesInput.value.replace(/,/g, '')) || 0;
            const cashSalesSupplyPrice = parseFloat(cashSalesSupplyPriceInput.value.replace(/,/g, '')) || 0;

            // 계산: (카드매출/1.1) + (현금영수증매출/1.1) + 현금매출 매출(공급가액)
            const totalSales = Math.floor((cardSales / 1.1) + (cashReceiptSales / 1.1) + cashSalesSupplyPrice);

            // 결과를 천 단위 구분자로 포맷팅
            if (totalSales) {
                totalSalesInput.value = totalSales.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            } else {
                totalSalesInput.value = '';
            }
            
            // 상품매출 자동 계산 (총 매출 - 서비스 매출)
            calculateProductSalesFromTotal();
        }

        function calculateTotals() {
            // 서비스 매출 테이블의 행들 선택
            const h3Elements = document.querySelectorAll('h3');
            let serviceTable;
            for (const h3 of h3Elements) {
                if (h3.textContent.includes('서비스 매출')) {
                    serviceTable = h3.nextElementSibling.querySelector('.game-cost-table');
                    break;
                }
            }
            
            const rows = serviceTable.querySelectorAll('tbody tr');
            let totalSupplyPrice = 0;
            let totalGamePurchaseTime = 0;

            rows.forEach(row => {
                // 공급가액 입력 필드가 있는 행만 처리
                const input = row.querySelector('input');
                if (input) {
                    const supplyPrice = parseFloat(input.value.replace(/,/g, '')) || 0;
                    const gamePurchaseTime = parseFloat(row.cells[3].textContent.replace(/,/g, '')) || 0;
                    
                    totalSupplyPrice += supplyPrice;
                    totalGamePurchaseTime += gamePurchaseTime;
                }
            });

            // 총 공급금액과 총 매입시간 업데이트
            document.getElementById('totalSupplyPrice').value = totalSupplyPrice.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            document.getElementById('totalGamePurchaseTime').value = totalGamePurchaseTime.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            
            // 총 공급금액과 총 매입시간이 업데이트되면 서비스 매출도 업데이트
            calculateServiceSales();
            
            // 디버깅용 콘솔 로그
            console.log('총 공급금액:', totalSupplyPrice);
            console.log('총 매입시간:', totalGamePurchaseTime);
        }

        function calculateServiceSales() {
            // 값이 비어있거나 숫자가 아닐 경우 0으로 처리
            const gameFeeEl = document.getElementById('gameFee');
            const totalGamePurchaseTimeEl = document.getElementById('totalGamePurchaseTime');
            const totalSupplyPriceEl = document.getElementById('totalSupplyPrice');
            const supplyMultiplierEl = document.getElementById('supplyMultiplier');
            
            const gameFee = gameFeeEl.value.trim() === '' ? 0 : parseFloat(gameFeeEl.value.replace(/,/g, '')) || 0;
            const totalGamePurchaseTime = totalGamePurchaseTimeEl.value.trim() === '' ? 0 : parseFloat(totalGamePurchaseTimeEl.value.replace(/,/g, '')) || 0;
            const totalSupplyPrice = totalSupplyPriceEl.value.trim() === '' ? 0 : parseFloat(totalSupplyPriceEl.value.replace(/,/g, '')) || 0;
            
            // 값이 비어있는 경우 기본값 4 사용, 아니면 입력값 사용(0도 유효한 입력값)
            const supplyMultiplierValue = supplyMultiplierEl.value.trim();
            const supplyMultiplier = supplyMultiplierValue === "" ? 4 : parseFloat(supplyMultiplierValue.replace(/,/g, '')) || 0;
            
            // 시간환산기준 계산 (게임료 × 총 매입시간)
            const timeBasedSales = gameFee * totalGamePurchaseTime;
            document.getElementById('timeBasedSales').value = timeBasedSales.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            
            // 매입N배기준 계산 (총 공급금액 × 사용자 입력 배율)
            const supplyXSales = totalSupplyPrice * supplyMultiplier;
            document.getElementById('supplyX4Sales').value = supplyXSales.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            
            // 서비스 매출이 변경되면 상품매출도 업데이트
            calculateProductSalesFromTotal();
        }

        function calculateProductTotals() {
            console.log('calculateProductTotals 함수 실행');
            
            // 상품매출 테이블의 공급가액 입력 필드 선택
            const productInputs = document.querySelectorAll('.product-price-input');
            console.log('상품매출 테이블 입력 필드 수:', productInputs.length);
            
            // 총 유통매입가액 계산
            let total = 0;
            productInputs.forEach(input => {
                const value = parseFloat(input.value.replace(/,/g, '')) || 0;
                console.log('상품매출 입력값:', input.value, '변환된 값:', value);
                total += value;
            });
            
            console.log('계산된 총 유통매입가액:', total);
            
            // 총 유통매입가액 입력 필드 업데이트
            const totalDistributionPrice = document.getElementById('totalDistributionPrice');
            if (totalDistributionPrice) {
                const oldValue = totalDistributionPrice.value;
                totalDistributionPrice.value = total.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                console.log('총 유통매입가액 업데이트됨:', totalDistributionPrice.value);
                
                // 총 유통매입가액이 변경되었다면 마진율 재계산
                if (oldValue !== totalDistributionPrice.value) {
                    calculateSimpleMarginRate();
                }
            } else {
                console.error('totalDistributionPrice 요소를 찾을 수 없습니다.');
            }
            
            // 마진율이 입력되어 있다면 상품매출 계산
            calculateProductSales();
        }
        
        function calculateProductSales() {
            // 상품매출액 산출식 섹션의 상품매출을 가져옴
            const productSales = parseFloat(document.getElementById('productSales').value.replace(/,/g, '')) || 0;
            
            // 총 유통매입가액 섹션의 상품매출에 동일한 값 설정
            document.getElementById('finalProductSales').value = productSales.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            
            // 상품매출이 업데이트되면 총매출도 업데이트
            updateTotalRevenue();
        }

        // 새로운 함수: 총 매출에서 서비스 매출을 빼서 상품매출 계산
        function calculateProductSalesFromTotal() {
            const totalSales = parseFloat(document.getElementById('totalSales').value.replace(/,/g, '')) || 0;
            const serviceSales = parseFloat(document.getElementById('serviceSales').value.replace(/,/g, '')) || 0;
            const productSalesInput = document.getElementById('productSales');
            
            if (totalSales || serviceSales) {
                // 상품매출 = 총 매출 - 서비스 매출
                const productSales = Math.max(0, totalSales - serviceSales);
                const oldValue = productSalesInput.value;
                productSalesInput.value = productSales.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                
                console.log("상품매출액 계산: " + productSales);
                
                // 상품매출이 변경되었으면 마진율 재계산
                if (oldValue !== productSalesInput.value) {
                    console.log("상품매출액 변경됨. 마진율 계산 시작");
                    calculateSimpleMarginRate();
                    
                    // 총 유통매입가액 섹션의 상품매출에도 동일한 값 설정
                    document.getElementById('finalProductSales').value = productSales.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                }
            } else {
                productSalesInput.value = '';
                // 상품매출이 없으면 마진율도 0으로 설정
                document.getElementById('marginRate').value = '0';
                // 총 유통매입가액 섹션의 상품매출에도 빈 값 설정
                document.getElementById('finalProductSales').value = '';
            }
        }
        
        function calculateOtherGameCompanyTotals() {
            console.log('calculateOtherGameCompanyTotals 함수 실행');
            
            // 그 외 게임사별 매입금액 테이블 찾기
            const h3Elements = document.querySelectorAll('h3');
            let otherGameCompanyTable;
            
            for (const h3 of h3Elements) {
                if (h3.textContent.includes('그 외 게임사별 매입금액')) {
                    const nextDiv = h3.nextElementSibling;
                    if (nextDiv && nextDiv.tagName === 'DIV') {
                        otherGameCompanyTable = nextDiv.querySelector('table');
                    }
                    break;
                }
            }
            
            if (!otherGameCompanyTable) {
                console.error('그 외 게임사별 매입금액 테이블을 찾을 수 없습니다.');
                return;
            }
            
            console.log('그 외 게임사별 매입금액 테이블 찾음:', otherGameCompanyTable);
            
            // 공급가액 입력 필드 선택
            const supplyPriceInputs = otherGameCompanyTable.querySelectorAll('tbody tr td:nth-child(2) input');
            console.log('공급가액 입력 필드 수:', supplyPriceInputs.length);
            
            // 총 매입금액 계산
            let total = 0;
            supplyPriceInputs.forEach(input => {
                const value = parseFloat(input.value.replace(/,/g, '')) || 0;
                console.log('입력값:', input.value, '변환된 값:', value);
                total += value;
            });
            
            console.log('계산된 총 매입금액:', total);
            
            // 서비스 매출 테이블의 "그외" 행 찾기
            let serviceTable;
            for (const h3 of h3Elements) {
                if (h3.textContent.includes('서비스 매출')) {
                    const nextDiv = h3.nextElementSibling;
                    if (nextDiv && nextDiv.tagName === 'DIV') {
                        serviceTable = nextDiv.querySelector('table');
                    }
                    break;
                }
            }
            
            if (!serviceTable) {
                console.error('서비스 매출 테이블을 찾을 수 없습니다.');
                return;
            }
            
            console.log('서비스 매출 테이블 찾음:', serviceTable);
            
            // "그외" 행 찾기
            const rows = serviceTable.querySelectorAll('tbody tr');
            let otherRow;
            
            for (const row of rows) {
                if (row.cells[0].textContent.trim() === '그외') {
                    otherRow = row;
                    break;
                }
            }
            
            if (!otherRow) {
                console.error('서비스 매출 테이블에서 "그외" 행을 찾을 수 없습니다.');
                return;
            }
            
            console.log('서비스 매출 테이블의 "그외" 행 찾음:', otherRow);
            
            // "그외" 행의 공급가액 입력 필드 찾기
            const otherRowInput = otherRow.querySelector('td:nth-child(3) input');
            
            if (!otherRowInput) {
                console.error('서비스 매출 테이블의 "그외" 행에서 공급가액 입력 필드를 찾을 수 없습니다.');
                return;
            }
            
            // 공급가액 입력 필드에 총 매입금액 설정
            otherRowInput.value = total.toLocaleString();
            console.log('서비스 매출 테이블의 "그외" 행 공급가액 업데이트 완료:', otherRowInput.value);
            
            // 게임 매입 시간 계산 및 총액 업데이트
            calculateGamePurchaseTime(otherRowInput);
            calculateTotals();
        }
        
        function calculateMarginRateFromSales() {
            const productSales = parseFloat(document.getElementById('productSales').value.replace(/,/g, '')) || 0;
            const totalDistributionPrice = parseFloat(document.getElementById('totalDistributionPrice').value.replace(/,/g, '')) || 0;
            const marginRateInput = document.getElementById('marginRate');
            
            if (productSales && totalDistributionPrice && totalDistributionPrice > 0) {
                // 마진율 = ((상품매출 / 총 오튱매입가액) - 1) * 100
                const marginRate = Math.round(((productSales / totalDistributionPrice) - 1) * 100);
                marginRateInput.value = marginRate.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            } else {
                marginRateInput.value = '';
            }
        }
        
        function updateSectionMarginRate() {
            // 상품매출액 산출식 섹션의 상품매출 가져오기
            const sectionProductSales = parseFloat(document.getElementById('productSales').value.replace(/,/g, '')) || 0;
            // 총 유통매입가액 가져오기
            const totalDistributionPrice = parseFloat(document.getElementById('totalDistributionPrice').value.replace(/,/g, '')) || 0;
            
            // 마진율 입력 필드 찾기
            const marginRateInput = document.getElementById('marginRate');
            const productMarginRateInput = document.getElementById('productMarginRate');
            
            if (sectionProductSales > 0 && totalDistributionPrice > 0) {
                // 마진율 = (상품매출 / 총유통매입가액) * 100
                const marginRate = Math.round((sectionProductSales / totalDistributionPrice) * 100);
                
                // 두 섹션의 마진율 입력 필드 업데이트, 천 단위 구분자 추가
                marginRateInput.value = marginRate.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                productMarginRateInput.value = marginRate.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                
                console.log('마진율 계산됨:', marginRate + '%');
                console.log('계산식: (' + sectionProductSales + ' / ' + totalDistributionPrice + ') * 100 = ' + marginRate + '%');
            } else {
                marginRateInput.value = '';
                productMarginRateInput.value = '';
            }
        }
        
        // 환산매출 계산 함수
        function calculateConvertedRevenue() {
            const productSales = parseFloat(document.getElementById('productSales').value.replace(/,/g, '')) || 0;
            const serviceSales = parseFloat(document.getElementById('serviceSales').value.replace(/,/g, '')) || 0;
            const creditCardTaxDeduction = parseFloat(document.getElementById('creditCardTaxDeduction').value.replace(/,/g, '')) || 0;
            const revenueDivision = parseFloat(document.getElementById('revenueDivision').value) || 0.667;
            
            // 환산매출 = (상품매출 × 5억/7.5억) + 서비스 매출 + 신용카드발행세액공제
            const convertedRevenue = (productSales * revenueDivision) + serviceSales + creditCardTaxDeduction;
            
            document.getElementById('convertedRevenue').value = Math.round(convertedRevenue).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        // 서비스 매출과 상품매출의 합을 총매출에 표시하는 함수
        function updateTotalRevenue() {
            const serviceSales = parseFloat(document.getElementById('serviceSales').value.replace(/,/g, '')) || 0;
            // 상품매출액 산출식의 상품매출 사용 (대신 finalProductSales 대신)
            const productSales = parseFloat(document.getElementById('productSales').value.replace(/,/g, '')) || 0;
            
            // 총매출 = 서비스 매출 + 상품매출
            const totalRevenue = serviceSales + productSales;
            
            // 총매출 입력 필드에 값 표시
            document.getElementById('totalRevenue').value = totalRevenue.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            
            // 환산매출도 업데이트
            calculateConvertedRevenue();
        }

        // 자동 계산되는 읽기 전용 필드의 스타일 설정
        function styleReadOnlyFields() {
            const readOnlyFields = [
                'cashSales', 
                'cashSalesSupplyPrice', 
                'totalSales', 
                'totalGamePurchaseTime', 
                'timeBasedSales', 
                'supplyX4Sales',
                'totalDistributionPrice',
                'totalRevenue',
                'convertedRevenue'
                // 'productSales' 제거 - 상품매출 필드는 이제 수정 가능
            ];
            
            readOnlyFields.forEach(id => {
                const field = document.getElementById(id);
                if (field) {
                    field.style.border = 'none';
                    field.style.background = 'transparent';
                    field.style.appearance = 'none';
                    field.style.padding = '0';
                    field.style.margin = '0';
                    field.readOnly = true;
                    
                    // 상위 요소에 따라 폰트 크기 조정 방지
                    const currentFont = window.getComputedStyle(field).fontSize;
                    field.style.fontSize = currentFont;
                }
            });
            
            // 마진율 필드는 별도 스타일 지정
            const marginRateField = document.getElementById('marginRate');
            if (marginRateField) {
                marginRateField.readOnly = true;
                marginRateField.style.background = '#f0f8ff'; // 연한 하늘색 배경으로 변경
                marginRateField.style.border = '1px solid #4682b4'; // 테두리 추가
            }
            
            // 상품매출 필드도 수정 가능하게 설정
            const productSalesField = document.getElementById('productSales');
            if (productSalesField) {
                productSalesField.readOnly = false;
                productSalesField.style.background = 'transparent'; // 노란색 배경에서 투명으로 변경
                productSalesField.style.border = 'none'; // 테두리 제거
            }
            
            // 상품 마진율 필드는 읽기 전용이 아님 - 스타일 기본값 유지
            const productMarginRateField = document.getElementById('productMarginRate');
            if (productMarginRateField) {
                productMarginRateField.readOnly = false;
                productMarginRateField.style.background = 'transparent'; // 투명 배경으로 변경
                productMarginRateField.style.border = 'none'; // 테두리 제거
            }
            
            // 게임매입시간 셀 내용도 스타일 조정
            const gameTimeCells = document.querySelectorAll('.game-cost-table tbody tr td:nth-child(4)');
            gameTimeCells.forEach(cell => {
                cell.style.background = 'transparent';
            });
        }
        
        // 마진율 값을 강제로 업데이트하는 함수 추가
        function forceUpdateMarginRate() {
            // 상품매출액 산출식 섹션의 상품매출 가져오기
            const productSales = parseFloat(document.getElementById('productSales').value.replace(/,/g, '')) || 0;
            // 총 유통매입가액 가져오기
            const totalDistributionPrice = parseFloat(document.getElementById('totalDistributionPrice').value.replace(/,/g, '')) || 0;
            
            if (productSales > 0 && totalDistributionPrice > 0) {
                // 마진율 = (상품매출 / 총유통매입가액) * 100
                const marginRate = Math.round((productSales / totalDistributionPrice) * 100);
                
                const marginRateInput = document.getElementById('marginRate');
                const productMarginRateInput = document.getElementById('productMarginRate');
                
                // 천 단위 구분자 추가
                marginRateInput.value = marginRate.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                productMarginRateInput.value = marginRate.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                
                console.log('마진율 강제 업데이트 완료: ' + marginRate + '%');
                console.log('계산식: (' + productSales + ' / ' + totalDistributionPrice + ') * 100 = ' + marginRate + '%');
            }
        }
        
        // 직접 마진율을 계산하는 함수
        function directCalcMarginRate() {
            // 상품매출액 산출식 섹션의 상품매출 가져오기
            const productSales = parseFloat(document.getElementById('productSales').value.replace(/,/g, '')) || 0;
            // 총 유통매입가액 가져오기
            const totalDistributionPrice = parseFloat(document.getElementById('totalDistributionPrice').value.replace(/,/g, '')) || 0;
            
            if (productSales > 0 && totalDistributionPrice > 0) {
                // 마진율 = (상품매출 / 총유통매입가액) * 100
                const marginRate = Math.round((productSales / totalDistributionPrice) * 100);
                
                // 천 단위 구분자 추가
                document.getElementById('marginRate').value = marginRate.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                document.getElementById('productMarginRate').value = marginRate.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                
                console.log("마진율 계산: " + marginRate + "%");
                
                // 마진율 입력 필드 스타일 설정
                const marginRateField = document.getElementById('marginRate');
                if (marginRateField) {
                    marginRateField.value = marginRate.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                    marginRateField.style.border = '1px solid #4682b4';
                    marginRateField.style.background = '#f0f8ff';
                    marginRateField.style.padding = '5px 8px';
                    marginRateField.style.textAlign = 'right';
                    marginRateField.style.width = '110px';
                    marginRateField.style.appearance = 'textfield';
                    marginRateField.style.fontSize = '15px';
                    marginRateField.style.lineHeight = '1.3';
                }
                
                return marginRate;
            }
            return 0;
        }
        
        // 마진율 계산 함수를 간소화 및 수정
        function calculateSimpleMarginRate() {
            try {
                const productSales = parseFloat(document.getElementById('productSales').value.replace(/,/g, '')) || 0;
                const totalDistributionPrice = parseFloat(document.getElementById('totalDistributionPrice').value.replace(/,/g, '')) || 1; // 0으로 나누기 방지
                
                console.log("계산 입력값: 상품매출=" + productSales + ", 총유통매입가액=" + totalDistributionPrice);
                
                // 마진율 = (상품매출 / 총유통매입가액) * 100
                let marginRate = 0;
                
                if (productSales > 0 && totalDistributionPrice > 0) {
                    // 반올림 처리
                    marginRate = Math.round((productSales / totalDistributionPrice) * 100);
                }
                
                // 마진율 값을 표시 - 두 필드 모두 업데이트, 천 단위 구분자 추가
                document.getElementById('marginRate').value = marginRate.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                document.getElementById('productMarginRate').value = marginRate.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                
                console.log("마진율 계산 결과: " + marginRate + "%");
                console.log("계산식: (" + productSales + " / " + totalDistributionPrice + ") * 100 = " + marginRate + "%");
                
                return marginRate;
            } catch (error) {
                console.error("마진율 계산 오류:", error);
                return 0;
            }
        }
        
        // 페이지 로드 시 초기화
        window.onload = function() {
            console.log('페이지 로드 시작');
            
            // 읽기 전용 필드의 스타일 적용
            styleReadOnlyFields();
            
            // 서비스 매출 입력 필드에 이벤트 리스너 추가
            document.getElementById('serviceSales').addEventListener('input', function() {
                formatNumber(this);
                // 서비스 매출이 변경되면 상품매출액 산출 식 섹션의 상품매출 재계산
                calculateProductSalesFromTotal();
                // 총매출과 환산매출 업데이트
                updateTotalRevenue();
                calculateConvertedRevenue();
            });
            
            // 총 매출 필드에 이벤트 리스너 추가 - 값이 변경될 때마다 상품매출 재계산
            document.getElementById('totalSales').addEventListener('change', function() {
                calculateProductSalesFromTotal();
                calculateConvertedRevenue();
            });
            
            // 마진율 입력 필드 읽기 전용으로 설정
            document.getElementById('marginRate').readOnly = true;
            
            // 상품매출 입력 필드에 이벤트 리스너 추가
            document.getElementById('productSales').addEventListener('input', function() {
                formatNumber(this);
                // 상품매출이 변경될 때마다 마진율 재계산
                calculateSimpleMarginRate();
                // 총 유통매입가액 섹션의 상품매출과 동기화
                document.getElementById('finalProductSales').value = this.value;
                // 총매출과 환산매출 업데이트
                updateTotalRevenue();
                calculateConvertedRevenue();
            });
            
            // 상품 마진율 필드에 이벤트 리스너 추가
            document.getElementById('productMarginRate').addEventListener('input', function() {
                formatNumber(this);
                // 마진율 변경 시 상품매출 자동 계산 없이 그대로 유지
            });
            
            // finalProductSales 입력 필드에 이벤트 리스너 추가
            document.getElementById('finalProductSales').addEventListener('input', function() {
                formatNumber(this);
                // 총 유통매입가액 섹션의 상품매출이 변경되면 상품매출액 산출식 섹션의 상품매출과 동기화
                document.getElementById('productSales').value = this.value;
                // 총매출과 환산매출 업데이트
                updateTotalRevenue();
                calculateConvertedRevenue();
            });
            
            // 총 공급금액 입력 필드 읽기 전용으로 설정
            document.getElementById('totalSupplyPrice').readOnly = true;
            
            // 총 유통매입가액 입력 필드 읽기 전용으로 설정
            document.getElementById('totalDistributionPrice').readOnly = true;
            document.getElementById('totalDistributionPrice').addEventListener('change', function() {
                console.log("총 유통매입가액 직접 변경 이벤트 발생");
                calculateSimpleMarginRate();
                calculateConvertedRevenue();
            });
            
            // 환산매출 필드 읽기 전용으로 설정
            document.getElementById('convertedRevenue').readOnly = true;
            
            // 신용카드발행세액공제 입력 필드에 이벤트 리스너 추가
            document.getElementById('creditCardTaxDeduction').addEventListener('input', function() {
                formatNumber(this);
                calculateConvertedRevenue();
            });
            
            // revenueDivision 필드가 변경될 때 환산매출 업데이트
            document.getElementById('revenueDivision').addEventListener('change', function() {
                calculateConvertedRevenue();
            });
            
            document.getElementById('revenueLimit').addEventListener('change', function() {
                calculateConvertedRevenue();
            });
            
            // 서비스 매출 테이블의 공급가액 입력 필드에 이벤트 리스너 추가
            const serviceInputs = document.querySelectorAll('.game-cost-table tbody tr td:nth-child(3) input');
            serviceInputs.forEach(input => {
                input.addEventListener('input', function() {
                    formatNumber(this);
                    calculateGamePurchaseTime(this);
                    calculateTotals();
                });
            });
            
            // 그 외 게임사별 매입금액 테이블의 공급가액 입력 필드에 이벤트 리스너 추가
            const tables = document.querySelectorAll('.game-cost-table');
            if (tables.length >= 2) {
                const otherGameCompanyTable = tables[1]; // 두 번째 테이블이 그 외 게임사별 매입금액 테이블
                console.log('그 외 게임사별 매입금액 테이블 찾음:', otherGameCompanyTable);
                
                const otherGameCompanyInputs = otherGameCompanyTable.querySelectorAll('tbody tr td:nth-child(2) input');
                console.log('그 외 게임사별 매입금액 테이블 입력 필드 수:', otherGameCompanyInputs.length);
                
                otherGameCompanyInputs.forEach(input => {
                    input.addEventListener('input', function() {
                        console.log('그 외 게임사별 매입금액 입력 필드 변경 감지:', this.value);
                        formatNumber(this);
                        calculateOtherGameCompanyTotals();
                    });
                });
                
                // 초기 계산 실행
                calculateOtherGameCompanyTotals();
            } else {
                console.error('그 외 게임사별 매입금액 테이블을 찾을 수 없습니다. 테이블 수:', tables.length);
            }
            
            // 상품매출 테이블의 공급가액 입력 필드 확인
            const productInputs = document.querySelectorAll('.product-price-input');
            console.log('상품매출 입력 필드 찾음 (클래스로):', productInputs.length);
            
            // 모든 product-price-input 클래스 요소에 이벤트 리스너 추가
            productInputs.forEach((input, index) => {
                console.log(`상품매출 입력 필드 #${index+1} 확인`);
                input.addEventListener('input', function() {
                    console.log(`상품매출 입력 필드 #${index+1} 변경됨:`, this.value);
                    formatNumber(this);
                    calculateProductTotals();
                });
            });
            
            // 최종 상품매출 입력 필드에 이벤트 리스너 추가
            document.getElementById('finalProductSales').addEventListener('input', function() {
                formatNumber(this);
                updateTotalRevenue();
            });
            
            // 초기 계산 실행
            calculateProductTotals();
            updateTotalRevenue();
            calculateProductSalesFromTotal(); // 페이지 로드 시 상품매출 초기 계산
            calculateSimpleMarginRate(); // 페이지 로드 시 마진율 초기 계산
            
            // 5억/7.5억 계산 결과 설정
            const fiveHundredMillion = 500000000;
            const sevenFiveHundredMillion = 750000000;
            const divisionResult = (fiveHundredMillion / sevenFiveHundredMillion).toFixed(3);
            document.getElementById('revenueDivision').value = divisionResult;
            
            // 디버깅용 콘솔 로그
            console.log('페이지 로드 완료');
        }

        // 상품매출 입력 필드 이벤트 리스너 - 제거
        /* document.getElementById('productSales').addEventListener('input', function() {
            formatNumber(this);
            // 상품매출이 변경될 때마다 마진율 즉시 계산
            const productSales = parseFloat(this.value.replace(/,/g, '')) || 0;
            const totalDistributionPrice = parseFloat(document.getElementById('totalDistributionPrice').value.replace(/,/g, '')) || 0;
            
            if (productSales > 0 && totalDistributionPrice > 0) {
                // 마진율 = (상품매출 / 총유통매입가액) * 100
                const marginRate = Math.round((productSales / totalDistributionPrice) * 100);
                document.getElementById('marginRate').value = marginRate;
                document.getElementById('productMarginRate').value = marginRate;
            }
        }); */

        // 상품매출 값이 변경될 때마다 마진율 자동 계산
        const productSalesObserver = new MutationObserver(function(mutations) {
            console.log("상품매출 값 변경 감지");
            calculateSimpleMarginRate();
        });
        
        // 상품매출 필드 관찰 시작
        productSalesObserver.observe(document.getElementById('productSales'), {
            attributes: true, 
            attributeFilter: ['value']
        });
        
        // 총 유통매입가액 값이 변경될 때마다 마진율 자동 계산
        const totalDistributionPriceObserver = new MutationObserver(function(mutations) {
            console.log("총 유통매입가액 변경 감지됨");
            // 상품매출액 산출 식의 마진율 계산
            calculateSimpleMarginRate();
        });
        
        // 총 유통매입가액 필드 관찰 시작
        totalDistributionPriceObserver.observe(document.getElementById('totalDistributionPrice'), {
            attributes: true, 
            attributeFilter: ['value']
        });
        
        // 총 유통매입가액 입력 필드 읽기 전용으로 설정
        document.getElementById('totalDistributionPrice').readOnly = true;

        // 총 매출 값이 변경될 때마다 상품매출 자동 계산
        const totalSalesObserver = new MutationObserver(function(mutations) {
            calculateProductSalesFromTotal();
        });
        
        // 총 매출 필드 관찰 시작
        totalSalesObserver.observe(document.getElementById('totalSales'), {
            attributes: true, 
            attributeFilter: ['value']
        });
        
        // 서비스 매출 값이 변경될 때마다 상품매출 자동 계산
        const serviceSalesObserver = new MutationObserver(function(mutations) {
            calculateProductSalesFromTotal();
        });
        
        // 서비스 매출 필드 관찰 시작
        serviceSalesObserver.observe(document.getElementById('serviceSales'), {
            attributes: true, 
            attributeFilter: ['value']
        });

        function addOtherGameCompanyRow() {
            const otherGameCompanyTable = document.querySelector('.game-purchase-table');
            if (!otherGameCompanyTable) {
                console.error('테이블을 찾을 수 없습니다.');
                return;
            }
            
            const tbody = otherGameCompanyTable.querySelector('tbody');
            const lastRow = tbody.lastElementChild;
            
            // 새로운 행 생성
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td style="padding: 0;"><input type="text" style="width: 100%; text-align: center; font-size: 1em; border: none; background-color: #ffffc0;"></td>
                <td style="padding: 0;"><input type="text" style="width: 100%; text-align: right; font-size: 1em; border: none; background-color: #ffffc0;" oninput="formatNumber(this); calculateOtherGameCompanyTotals()"></td>
            `;
            
            // 마지막 행 앞에 새 행 삽입
            tbody.insertBefore(newRow, lastRow);
            
            // 총액 재계산
            calculateOtherGameCompanyTotals();
        }
        
        function deleteOtherGameCompanyRow() {
            const otherGameCompanyTable = document.querySelector('.game-purchase-table');
            if (!otherGameCompanyTable) {
                console.error('테이블을 찾을 수 없습니다.');
                return;
            }
            
            const tbody = otherGameCompanyTable.querySelector('tbody');
            const rows = tbody.getElementsByTagName('tr');
            
            // 마지막 행(버튼이 있는 행)을 제외하고 최소 1행은 유지
            if (rows.length > 2) {
                tbody.removeChild(rows[rows.length - 2]);
                // 총액 재계산
                calculateOtherGameCompanyTotals();
            }
        }

        // 상품매출 테이블 행 추가 함수
        function addProductRow() {
            const productTable = document.querySelector('.product-sales-table');
            if (!productTable) {
                console.error('상품매출 테이블을 찾을 수 없습니다.');
                return;
            }
            
            const tbody = productTable.querySelector('tbody');
            const lastRow = tbody.lastElementChild;
            
            // 새로운 행 생성 (placeholder 제거)
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td style="padding: 0; height: 25px;"><input type="text" style="width: 100%; height: 100%; text-align: center; border: none; background-color: #ffffc0; font-size: 0.95em; padding: 4px; box-sizing: border-box;"></td>
                <td style="padding: 0; height: 25px;"><input type="text" class="product-price-input" style="width: 100%; height: 100%; text-align: right; border: none; background-color: #ffffc0; font-size: 0.95em; padding: 4px; box-sizing: border-box;" oninput="formatNumber(this); calculateProductTotals()"></td>
            `;
            
            // 마지막 행 앞에 새 행 삽입
            tbody.insertBefore(newRow, lastRow);
            
            // 총액 재계산
            calculateProductTotals();
        }
        
        function deleteProductRow() {
            const productTable = document.querySelector('.product-sales-table');
            if (!productTable) {
                console.error('상품매출 테이블을 찾을 수 없습니다.');
                return;
            }
            
            const tbody = productTable.querySelector('tbody');
            const rows = tbody.getElementsByTagName('tr');
            
            // 마지막 행(버튼이 있는 행)을 제외하고 최소 1행은 유지
            if (rows.length > 2) {
                tbody.removeChild(rows[rows.length - 2]);
                // 총액 재계산
                calculateProductTotals();
            }
        }

        // 저장하기 기능
        function saveData() {
            try {
                // 모든 입력 데이터 수집
                const data = {
                    shopName: document.getElementById('shopName').value,
                    serviceSales: {
                        nexon: document.querySelector('.game-cost-table tbody tr:nth-child(1) td:nth-child(3) input').value,
                        riot: document.querySelector('.game-cost-table tbody tr:nth-child(2) td:nth-child(3) input').value,
                        blizzard: document.querySelector('.game-cost-table tbody tr:nth-child(3) td:nth-child(3) input').value,
                        ncsoft: document.querySelector('.game-cost-table tbody tr:nth-child(4) td:nth-child(3) input').value,
                        kakao: document.querySelector('.game-cost-table tbody tr:nth-child(5) td:nth-child(3) input').value,
                        other: document.querySelector('.game-cost-table tbody tr:nth-child(6) td:nth-child(3) input').value,
                        gameFee: document.getElementById('gameFee').value,
                        serviceSalesTotal: document.getElementById('serviceSales').value,
                        totalSupplyPrice: document.getElementById('totalSupplyPrice').value,
                        totalGamePurchaseTime: document.getElementById('totalGamePurchaseTime').value,
                        timeBasedSales: document.getElementById('timeBasedSales').value,
                        supplyMultiplier: document.getElementById('supplyMultiplier').value, // 추가: 배율 저장
                        supplyX4Sales: document.getElementById('supplyX4Sales').value
                    },
                    otherGameCompanies: Array.from(document.querySelectorAll('.game-purchase-table tbody tr:not(:last-child)')).map(row => ({
                        company: row.querySelector('td:first-child input').value,
                        amount: row.querySelector('td:last-child input').value
                    })),
                    productSales: Array.from(document.querySelectorAll('.product-sales-table tbody tr:not(:last-child)')).map(row => ({
                        distributor: row.querySelector('td:first-child input').value,
                        amount: row.querySelector('td:last-child input').value
                    })),
                    calculations: {
                        cardSales: document.getElementById('cardSales').value,
                        ratio: document.getElementById('ratio').value,
                        cashReceiptSales: document.getElementById('cashReceiptSales').value,
                        cashSales: document.getElementById('cashSales').value,
                        cashSalesSupplyPrice: document.getElementById('cashSalesSupplyPrice').value,
                        totalSales: document.getElementById('totalSales').value,
                        marginRate: document.getElementById('marginRate').value,
                        productMarginRate: document.getElementById('productMarginRate').value,
                        totalDistributionPrice: document.getElementById('totalDistributionPrice').value,
                        finalProductSales: document.getElementById('finalProductSales').value,
                        totalRevenue: document.getElementById('totalRevenue').value,
                        creditCardTaxDeduction: document.getElementById('creditCardTaxDeduction').value,
                        revenueDivision: document.getElementById('revenueDivision').value,
                        convertedRevenue: document.getElementById('convertedRevenue').value,
                        productSales: document.getElementById('productSales').value
                    }
                };

                // localStorage에 데이터 저장
                localStorage.setItem('pcRoomCalculatorData', JSON.stringify(data));
                alert('데이터가 저장되었습니다.');
            } catch (error) {
                console.error('데이터 저장 중 오류 발생:', error);
                alert('데이터 저장 중 오류가 발생했습니다.');
            }
        }

        // 삭제하기 기능
        function clearData() {
            if (confirm('모든 데이터를 삭제하시겠습니까?')) {
                // localStorage에서 데이터 삭제
                localStorage.removeItem('pcRoomCalculatorData');
                
                // 모든 입력 필드 초기화
                document.getElementById('shopName').value = '';
                
                // 서비스 매출 테이블 초기화
                document.querySelectorAll('.game-cost-table tbody tr td:nth-child(3) input').forEach(input => {
                    input.value = '';
                    // 게임매입시간 셀 초기화 (텍스트 내용)
                    const timeCell = input.closest('tr').cells[3];
                    if (timeCell) timeCell.textContent = '0';
                });
                
                // 그 외 게임사별 매입금액 테이블 초기화 (행 삭제 및 기본 행 추가)
                const otherGameTableBody = document.querySelector('.game-purchase-table tbody');
                const otherButtonRow = otherGameTableBody.lastElementChild;
                while (otherGameTableBody.firstChild && otherGameTableBody.firstChild !== otherButtonRow) {
                    otherGameTableBody.removeChild(otherGameTableBody.firstChild);
                }
                for (let i = 0; i < 4; i++) { // 기본 4행 추가
                    addOtherGameCompanyRow('', '');
                }
                
                // 상품매출 테이블 초기화 (행 삭제 및 기본 행 추가)
                const productTableBody = document.querySelector('.product-sales-table tbody');
                const productButtonRow = productTableBody.lastElementChild;
                while (productTableBody.firstChild && productTableBody.firstChild !== productButtonRow) {
                    productTableBody.removeChild(productTableBody.firstChild);
                }
                for (let i = 0; i < 4; i++) { // 기본 4행 추가
                    addProductRow('', '');
                }
                
                // 계산 필드 초기화
                const calcIds = [
                    'gameFee', 'serviceSales', 'totalSupplyPrice', 'totalGamePurchaseTime', 
                    'timeBasedSales', 'supplyX4Sales', 'cardSales', 'ratio', 'cashReceiptSales', 
                    'cashSales', 'cashSalesSupplyPrice', 'totalSales', 'marginRate', 
                    'productMarginRate', 'totalDistributionPrice', 'finalProductSales', 
                    'totalRevenue', 'creditCardTaxDeduction', 'revenueDivision', 
                    'convertedRevenue', 'productSales'
                ];
                calcIds.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) element.value = '';
                });
                
                // 모든 계산 다시 실행
                calculateTotals();
                calculateOtherGameCompanyTotals();
                calculateProductTotals();
                
                // 5억/7.5억 비율 복원
                const fiveHundredMillion = 500000000;
                const sevenFiveHundredMillion = 750000000;
                const divisionResult = (fiveHundredMillion / sevenFiveHundredMillion).toFixed(3);
                document.getElementById('revenueDivision').value = divisionResult;

                alert('모든 데이터가 삭제되었습니다.');
            }
        }

        // 페이지 로드 시 저장된 데이터 불러오기
        window.addEventListener('load', function() {
            const savedData = localStorage.getItem('pcRoomCalculatorData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    
                    // 상호명 복원
                    if (data.shopName) {
                        document.getElementById('shopName').value = data.shopName;
                    }
                    
                    // 서비스 매출 데이터 복원
                    if (data.serviceSales) {
                        const serviceTable = document.querySelector('.game-cost-table tbody');
                        if (serviceTable) {
                            // 기본 필드 복원
                            const serviceFields = [
                                { key: 'nexon', selector: 'tr:nth-child(1) td:nth-child(3) input' },
                                { key: 'riot', selector: 'tr:nth-child(2) td:nth-child(3) input' },
                                { key: 'blizzard', selector: 'tr:nth-child(3) td:nth-child(3) input' },
                                { key: 'ncsoft', selector: 'tr:nth-child(4) td:nth-child(3) input' },
                                { key: 'kakao', selector: 'tr:nth-child(5) td:nth-child(3) input' },
                                { key: 'other', selector: 'tr:nth-child(6) td:nth-child(3) input' }
                            ];
                            serviceFields.forEach(field => {
                                const input = serviceTable.querySelector(field.selector);
                                if (input && data.serviceSales[field.key] !== undefined) {
                                    input.value = data.serviceSales[field.key];
                                    // 게임 매입 시간 복원
                                    calculateGamePurchaseTime(input);
                                }
                            });
                        }
                        // 추가 필드 복원
                        const additionalServiceFields = ['gameFee', 'serviceSalesTotal', 'totalSupplyPrice', 'totalGamePurchaseTime', 'timeBasedSales', 'supplyMultiplier', 'supplyX4Sales'];
                        additionalServiceFields.forEach(id => {
                            const element = document.getElementById(id);
                            if (element && data.serviceSales[id] !== undefined) {
                                element.value = data.serviceSales[id];
                            }
                        });
                    }
                    
                    // 그 외 게임사별 매입금액 데이터 복원
                    if (data.otherGameCompanies && data.otherGameCompanies.length > 0) {
                        const otherGameTableBody = document.querySelector('.game-purchase-table tbody');
                        const buttonRow = otherGameTableBody.lastElementChild;
                        // 기존 행들 제거
                        while (otherGameTableBody.firstChild && otherGameTableBody.firstChild !== buttonRow) {
                            otherGameTableBody.removeChild(otherGameTableBody.firstChild);
                        }
                        
                        // 저장된 데이터로 행 추가 (최대 4개)
                        let addedRowCount = 0;
                        data.otherGameCompanies.slice(0, 4).forEach(item => {
                            const newRow = document.createElement('tr');
                            newRow.innerHTML = `
                                <td style="padding: 0;"><input type="text" style="width: 100%; text-align: center; font-size: 1em; border: none; background-color: #ffffc0;" value="${item.company || ''}"></td>
                                <td style="padding: 0;"><input type="text" style="width: 100%; text-align: right; font-size: 1em; border: none; background-color: #ffffc0;" oninput="formatNumber(this); calculateOtherGameCompanyTotals()" value="${item.amount || ''}"></td>
                            `;
                            otherGameTableBody.insertBefore(newRow, buttonRow);
                            addedRowCount++;
                        });
                        
                        // 행이 4개 미만이면 빈 행 추가
                        while (addedRowCount < 4) {
                            addOtherGameCompanyRow('', '');
                            addedRowCount++;
                        }
                    }
                    
                    // 상품매출 데이터 복원
                    if (data.productSales && data.productSales.length > 0) {
                        const productTableBody = document.querySelector('.product-sales-table tbody');
                        const buttonRow = productTableBody.lastElementChild;
                        // 기존 행들 제거
                        while (productTableBody.firstChild && productTableBody.firstChild !== buttonRow) {
                            productTableBody.removeChild(productTableBody.firstChild);
                        }
                        
                        // 저장된 데이터로 행 추가 (최대 4개)
                        let addedRowCount = 0;
                        data.productSales.slice(0, 4).forEach(item => {
                            const newRow = document.createElement('tr');
                            newRow.innerHTML = `
                                <td style="padding: 0; height: 25px;"><input type="text" style="width: 100%; height: 100%; text-align: center; border: none; background-color: #ffffc0; font-size: 0.95em; padding: 4px; box-sizing: border-box;" value="${item.distributor || ''}"></td>
                                <td style="padding: 0; height: 25px;"><input type="text" class="product-price-input" style="width: 100%; height: 100%; text-align: right; border: none; background-color: #ffffc0; font-size: 0.95em; padding: 4px; box-sizing: border-box;" oninput="formatNumber(this); calculateProductTotals()" value="${item.amount || ''}"></td>
                            `;
                            productTableBody.insertBefore(newRow, buttonRow);
                            addedRowCount++;
                        });
                        
                        // 행이 4개 미만이면 빈 행 추가
                        while (addedRowCount < 4) {
                            addProductRow('', '');
                            addedRowCount++;
                        }
                    }
                    
                    // 계산 데이터 복원
                    if (data.calculations) {
                        const calculationFields = [
                            'cardSales', 'ratio', 'cashReceiptSales', 'cashSales', 'cashSalesSupplyPrice', 
                            'totalSales', 'marginRate', 'productMarginRate', 'totalDistributionPrice', 
                            'finalProductSales', 'totalRevenue', 'creditCardTaxDeduction', 
                            'revenueDivision', 'convertedRevenue', 'productSales'
                        ];
                        
                        calculationFields.forEach(id => {
                            const element = document.getElementById(id);
                            if (element && data.calculations[id] !== undefined) {
                                element.value = data.calculations[id];
                            }
                        });
                    }
                    
                    // 모든 계산 다시 실행
                    calculateTotals();
                    calculateOtherGameCompanyTotals();
                    calculateProductTotals();
                    calculateCashSales();
                    calculateTotalSales();
                    calculateServiceSales();
                    calculateProductSalesFromTotal();
                    calculateSimpleMarginRate();
                    updateTotalRevenue();
                    calculateConvertedRevenue();
                } catch (error) {
                    console.error('저장된 데이터 불러오기 중 오류 발생:', error);
                    alert('저장된 데이터를 불러오는 중 오류가 발생했습니다.');
                    localStorage.removeItem('pcRoomCalculatorData');
                }
            } else {
                // 데이터가 없는 경우 기본값 설정
                const fiveHundredMillion = 500000000;
                const sevenFiveHundredMillion = 750000000;
                const divisionResult = (fiveHundredMillion / sevenFiveHundredMillion).toFixed(3);
                document.getElementById('revenueDivision').value = divisionResult;
            }
        });
    </script>
</body>
</html>
